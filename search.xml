<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[Androidæ¶ˆæ¯æœºåˆ¶]]></title>
    <url>%2Fdesirelife6.github.io%2F2020%2F04%2F10%2FAndroid%E6%B6%88%E6%81%AF%E6%9C%BA%E5%88%B6%2F</url>
    <content type="text"><![CDATA[Androidçš„æ¶ˆæ¯æœºåˆ¶ä¸»è¦æ˜¯æŒ‡çš„Handlerçš„è¿è¡Œæœºåˆ¶ä»¥åŠHandleræ‰€é™„å¸¦çš„MessageQueueå’ŒLooperçš„å·¥ä½œè¿‡ç¨‹ï¼Œè¿™ä¸‰è€…å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ•´ä½“ã€‚ ä»å¼€å‘çš„è§’åº¦æ¥çœ‹ï¼ŒHandleræ˜¯æ¶ˆæ¯æœºåˆ¶çš„ä¸Šå±‚æ¥å£ï¼Œé€šè¿‡å®ƒæˆ‘ä»¬å¯ä»¥è½»æ¾çš„å°†ä¸€ä¸ªä»»åŠ¡åˆ‡æ¢åˆ°å®ƒæ‰€åœ¨çš„çº¿ç¨‹ä¸­å»æ‰§è¡Œã€‚ä»¥æ¶ˆæ¯ä¼ é€’ä¸ºä¾‹ï¼Œåœ¨ä¸€ä¸ªçº¿ç¨‹åˆ›å»ºHandlerï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹é€šè¿‡æŒæœ‰è¯¥Handlerçš„å¼•ç”¨è°ƒç”¨sendMessageå®ç°æ¶ˆæ¯åœ¨çº¿ç¨‹ä¹‹é—´çš„ä¼ é€’ã€‚MessageQueueçš„ä¸­æ–‡ç¿»è¯‘æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå†…éƒ¨é‡‡ç”¨å•é“¾è¡¨çš„æ•°æ®ç»“æ„æ¥å­˜å‚¨æ¶ˆæ¯åˆ—è¡¨ã€‚Looperçš„ä¸­æ–‡ç¿»è¯‘æ˜¯å¾ªç¯ï¼Œè¿™é‡Œå¯ä»¥ç†è§£ä¸ºæ¶ˆæ¯å¾ªç¯ã€‚ç”±äºMessageQueueåªæ˜¯ä¸€ä¸ªæ¶ˆæ¯çš„å­˜å‚¨å•å…ƒï¼Œå®ƒä¸èƒ½å»å¤„ç†æ¶ˆæ¯ï¼Œè€ŒLooperå°±å¡«è¡¥äº†è¿™ä¸ªåŠŸèƒ½ï¼ŒLooperä¼šä»¥æ— é™å¾ªç¯çš„å½¢å¼å»æŸ¥æ‰¾æ˜¯å¦æœ‰æ–°æ¶ˆæ¯ï¼Œå¦‚æœæœ‰çš„è¯å°±å¤„ç†æ¶ˆæ¯ï¼Œå¦åˆ™å°±ä¸€ç›´ç­‰å¾…ç€ã€‚Looperä¸­è¿˜æœ‰ä¸€ä¸ªç‰¹æ®Šçš„æ¦‚å¿µï¼šThreadLocalï¼Œå½“æˆ‘ä»¬è°ƒç”¨Looper.prepare()æ–¹æ³•åˆ›å»ºLooperæ—¶ä½¿ç”¨åˆ°å®ƒã€‚åœ¨Handlerå†…éƒ¨å°±æ˜¯é€šè¿‡ThreadLocalæ¥è·å–æ¯ä¸ªçº¿ç¨‹çš„Looperçš„ã€‚ Handlerçš„å†…éƒ¨å®ç°ä¸»è¦æ¶‰åŠåˆ°å¦‚ä¸‹å‡ ä¸ªç±»: Threadã€MessageQueueå’ŒLooperã€‚è¿™å‡ ç±»ä¹‹é—´çš„å…³ç³»å¯ä»¥ç”¨å¦‚ä¸‹çš„å›¾æ¥ç®€å•è¯´æ˜ï¼š Threadæ˜¯æœ€åŸºç¡€çš„ï¼ŒLooperå’ŒMessageQueueéƒ½æ„å»ºåœ¨Threadä¹‹ä¸Šï¼ŒHandleråˆæ„å»ºåœ¨Looperå’ŒMessageQueueä¹‹ä¸Šï¼Œæˆ‘ä»¬é€šè¿‡Handleré—´æ¥åœ°ä¸ä¸‹é¢è¿™å‡ ä¸ªç›¸å¯¹åº•å±‚ä¸€ç‚¹çš„ç±»æ‰“äº¤é“ã€‚ ä¸‹é¢æˆ‘ä»¬æ¥å…ˆåˆ†åˆ«ä»‹ç»ThreadLocalï¼ŒMessageQueueï¼ŒLooper, å’ŒHandlerçš„å·¥ä½œæœºåˆ¶ï¼Œå†å°†å®ƒä»¬çš„å·¥ä½œæµç¨‹è¿›è¡Œä¸€ä¸ªå¤§è‡´çš„ä¸²è®²ã€‚ 1. ThreadLocal1. æ¦‚è¿°ThreadLocalæ˜¯ä¸€ä¸ªçº¿ç¨‹å†…éƒ¨çš„æ•°æ®å­˜å‚¨ç±»ï¼Œé€šè¿‡å®ƒå¯ä»¥åœ¨æŒ‡å®šçš„çº¿ç¨‹ä¸­å­˜å‚¨æ•°æ®ï¼Œæ•°æ®å­˜å‚¨ä»¥åï¼Œåªæœ‰åœ¨æŒ‡å®šçº¿ç¨‹ä¸­å¯ä»¥è·å–åˆ°å­˜å‚¨çš„æ•°æ®ï¼Œå¯¹äºå…¶ä»–çº¿ç¨‹æ¥è¯´åˆ™æ— æ³•è·å–åˆ°æ•°æ®ã€‚ ä¸Šé¢çš„è¯å¯ä»¥ç†è§£ä¸ºï¼ŒThreadLocalæ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œç”¨æ¥å­˜å‚¨å¯¹åº”Threadçš„æœ¬åœ°å˜é‡ã€‚å½“ä½¿ç”¨ThreadLocalç»´æŠ¤å˜é‡æ—¶ï¼ŒThreadLocalä¸ºæ¯ä¸ªä½¿ç”¨è¯¥å˜é‡çš„çº¿ç¨‹æä¾›ç‹¬ç«‹çš„å˜é‡å‰¯æœ¬ï¼Œæ‰€ä»¥æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½å¯ä»¥ç‹¬ç«‹åœ°æ”¹å˜è‡ªå·±çš„å‰¯æœ¬ï¼Œè€Œä¸ä¼šå½±å“å…¶å®ƒçº¿ç¨‹æ‰€å¯¹åº”çš„å‰¯æœ¬ã€‚ ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š 123456789101112131415161718192021222324252627282930public class MainActivity extends AppCompatActivity &#123; private static final String TAG = "MainActivity"; //å®šä¹‰ThreadLocalå¯¹è±¡ private ThreadLocal&lt;Boolean&gt; mBooleanThreadLocal = new ThreadLocal&lt;&gt;(); @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_main); mBooleanThreadLocal.set(true); Log.d(TAG, "[Thread#main]mBooleanThreadLocal=" + mBooleanThreadLocal.get()); new Thread("Thread#1") &#123; @Override public void run() &#123; mBooleanThreadLocal.set(false); Log.d(TAG, "[Thread#1]mBooleanThreadLocal=" + mBooleanThreadLocal.get()); &#125; &#125;.start(); new Thread("Thread#2") &#123; @Override public void run() &#123; Log.d(TAG, "[Thread#2]mBooleanThreadLocal=" + mBooleanThreadLocal.get()); &#125; &#125;.start(); &#125;&#125; åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œåœ¨ä¸»çº¿ç¨‹ä¸­è®¾ç½®mBooleanThreadLocalçš„å€¼ä¸ºtrueï¼Œåœ¨å­çº¿ç¨‹1ä¸­è®¾ç½®mBooleanThreadLocalå€¼ä¸ºfalseï¼Œå­çº¿ç¨‹2ä¸­ä¸è®¾ç½®mBooleanThreadLocalçš„å€¼ã€‚ç„¶ååœ¨3ä¸ªçº¿ç¨‹ä¸­åˆ†åˆ«é€šè¿‡getæ–¹æ³•è·å–å€¼å¹¶æ‰“å°å‡ºæ¥ã€‚æ ¹æ®å‰é¢çš„æè¿°ï¼ŒæœŸæœ›çš„æ‰“å°ç»“æœåº”è¯¥æ˜¯ï¼šä¸»çº¿ç¨‹ä¸ºtrueï¼Œå­çº¿ç¨‹1ä¸ºfalseï¼Œå­çº¿ç¨‹2ä½nullï¼Œå› ä¸ºå­çº¿ç¨‹2ä¸­æ²¡æœ‰è®¾ç½®å€¼ã€‚å®é™…æ‰“å°ç»“æœå¦‚ä¸‹ï¼š å¯ä»¥çœ‹åˆ°ï¼Œå°½ç®¡åœ¨ä¸‰ä¸ªçº¿ç¨‹ä¸­è®¿é—®çš„ä¸ºåŒä¸€ä¸ªå¯¹è±¡ï¼Œä½†æ˜¯ThreadLocalä¸ºä»–ä»¬å„è‡ªç»´æŠ¤äº†ä¸€ä¸ªè¯¥å¯¹è±¡çš„å‰¯æœ¬ï¼Œæ‰€ä»¥è®¿é—®åˆ°çš„ç»“æœä¸åŒã€‚ 2. å®ç°åŸç†ThreadLocalæ˜¯ä¸€ä¸ªæ³›å‹ç±»ï¼Œpublic class ThreadLocal&lt;T&gt;ï¼Œè¦ç†è§£å®ƒçš„å·¥ä½œåŸç†ï¼Œå¯ä»¥ä»getå’Œsetæ–¹æ³•å…¥æ‰‹ï¼Œå…ˆæ¥çœ‹setæ–¹æ³•ï¼š 1234567891011121314151617/** * Sets the current thread's copy of this thread-local variable * to the specified value. Most subclasses will have no need to * override this method, relying solely on the &#123;@link #initialValue&#125; * method to set the values of thread-locals. * * @param value the value to be stored in the current thread's copy of * this thread-local. */ public void set(T value) &#123; Thread t = Thread.currentThread(); ThreadLocalMap map = getMap(t); if (map != null) map.set(this, value); else createMap(t, value); &#125; å¯è§ï¼Œé¦–å…ˆé€šè¿‡getMapæ–¹æ³•æ¥è·å–å½“å‰çº¿ç¨‹ä¸­çš„ThreadLocalæ•°æ®ï¼Œå¦‚æœè¿”å›çš„ThreadLocalMapå¯¹è±¡ä¸ä¸ºç©ºï¼Œåˆ™è°ƒç”¨setæ–¹æ³•æ·»åŠ æ•°æ®ï¼Œå¦åˆ™å°±åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡å¹¶æŠŠå€¼æ·»åŠ è¿›å»ã€‚ThreadLocalMapä¸­å®šä¹‰äº†ä¸€ä¸ªprivate Entry[] table;æ¥å­˜å‚¨æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡setæ–¹æ³•å°†æ•°æ®æ·»åŠ åˆ°tableæ•°ç»„ä¸­ã€‚ å†æ¥çœ‹çœ‹getæ–¹æ³•ï¼š 12345678910111213141516171819202122/** * Returns the value in the current thread's copy of this * thread-local variable. If the variable has no value for the * current thread, it is first initialized to the value returned * by an invocation of the &#123;@link #initialValue&#125; method. * * @return the current thread's value of this thread-local */ public T get() &#123; Thread t = Thread.currentThread(); ThreadLocalMap map = getMap(t); if (map != null) &#123; ThreadLocalMap.Entry e = map.getEntry(this); if (e != null) &#123; @SuppressWarnings("unchecked") T result = (T)e.value; return result; &#125; &#125; return setInitialValue(); &#125; å¯ä»¥å‘ç°ï¼ŒThreadLocalçš„getæ–¹æ³•åŒæ ·æ˜¯å…ˆå–å‡ºå½“å‰çº¿ç¨‹çš„ThreadLocalMap å¯¹è±¡ï¼Œå¦‚æœè¿™ä¸ªå¯¹è±¡ä¸ºnullå°±è¿”å›åˆå§‹å€¼ï¼Œè¿™ä¸ªåˆå§‹å€¼ç”±ThreadLocalçš„initialValue()æ–¹æ³•æ¥ç¡®å®šï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸ºnullï¼Œé»˜è®¤å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š 123protected T initialValue() &#123; return null;&#125; å¦‚æœThreadLocalMap å¯¹è±¡ä¸ä¸ºnullï¼Œé‚£ä¹ˆå°±å–å‡ºtableæ•°ç»„å¹¶æ‰¾åˆ°ç›¸åº”çš„å€¼è¿”å›å›å»ã€‚ ä»ThreadLocalçš„setå’Œgetæ–¹æ³•å¯ä»¥çœ‹å‡ºï¼Œå®ƒä»¬æ‰€æ“ä½œçš„å¯¹è±¡éƒ½æ˜¯å½“å‰çº¿ç¨‹çš„ThreadLocalMapå¯¹è±¡çš„tableæ•°ç»„ï¼Œå› æ­¤åœ¨ä¸åŒçº¿ç¨‹ä¸­è®¿é—®åŒä¸€ä¸ªThreadLocalçš„setå’Œgetæ–¹æ³•ï¼Œå®ƒä»¬å¯¹ThreadLocalæ‰€åšçš„è¯»/å†™æ“ä½œä»…é™äºå„çº¿ç¨‹çš„å†…éƒ¨ï¼Œæ‰€ä»¥ThreadLocalå¯ä»¥åœ¨å¤šä¸ªçº¿ç¨‹ä¸­äº’ä¸å¹²æ‰°åœ°å­˜å‚¨å’Œä¿®æ”¹æ•°æ®ã€‚ 3. ä¸Androidæ¶ˆæ¯æœºåˆ¶çš„è”ç³»å½“æˆ‘ä»¬åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­åˆ›å»ºä¸€ä¸ªHandlerï¼Œè°ƒç”¨Looper.prepare()æ—¶é€šè¿‡ThreadLocalä¿å­˜å½“å‰çº¿ç¨‹ä¸‹çš„Looperå¯¹è±¡ï¼Œè€Œæ‰€æœ‰çº¿ç¨‹çš„Looperéƒ½ç”±ä¸€ä¸ªThreadLocalæ¥ç»´æŠ¤ï¼Œä¹Ÿå°±æ˜¯åœ¨æ‰€æœ‰çº¿ç¨‹ä¸­åˆ›å»ºçš„Looperéƒ½å­˜æ”¾åœ¨äº†åŒä¸€ä¸ªThreadLocalä¸­ã€‚è€ŒHandleråˆä¸LooperååŒå·¥ä½œï¼Œå¤§è‡´å…³ç³»å¦‚ä¸‹å›¾ï¼š 2. MessageQueueæœ€åŸºç¡€æœ€åº•å±‚çš„æ˜¯Threadï¼Œæ¯ä¸ªçº¿ç¨‹å†…éƒ¨éƒ½ç»´æŠ¤äº†ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—â€”â€”MessageQueueã€‚æ¶ˆæ¯é˜Ÿåˆ—MessageQueueï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å­˜æ”¾æ¶ˆæ¯çš„é˜Ÿåˆ—ï¼ˆå¥½åƒæ˜¯åºŸè¯â€¦ï¼‰ã€‚é‚£é˜Ÿåˆ—ä¸­å­˜å‚¨çš„æ¶ˆæ¯æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå‡è®¾æˆ‘ä»¬åœ¨UIç•Œé¢ä¸Šå•å‡»äº†æŸä¸ªæŒ‰é’®ï¼Œè€Œæ­¤æ—¶ç¨‹åºåˆæ°å¥½æ”¶åˆ°äº†æŸä¸ªå¹¿æ’­äº‹ä»¶ï¼Œé‚£æˆ‘ä»¬å¦‚ä½•å¤„ç†è¿™ä¸¤ä»¶äº‹å‘¢ï¼Ÿ å› ä¸ºä¸€ä¸ªçº¿ç¨‹åœ¨æŸä¸€æ—¶åˆ»åªèƒ½å¤„ç†ä¸€ä»¶äº‹æƒ…ï¼Œä¸èƒ½åŒæ—¶å¤„ç†å¤šä»¶äº‹æƒ…ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½åŒæ—¶å¤„ç†æŒ‰é’®çš„å•å‡»äº‹ä»¶å’Œå¹¿æ’­äº‹ä»¶ï¼Œæˆ‘ä»¬åªèƒ½æŒ¨ä¸ªå¯¹å…¶è¿›è¡Œå¤„ç†ï¼Œåªè¦æŒ¨ä¸ªå¤„ç†å°±è¦æœ‰å¤„ç†çš„å…ˆåé¡ºåºã€‚ ä¸ºæ­¤AndroidæŠŠUIç•Œé¢ä¸Šå•å‡»æŒ‰é’®çš„äº‹ä»¶å°è£…æˆäº†ä¸€ä¸ªMessageï¼Œå°†å…¶æ”¾å…¥åˆ°MessageQueueé‡Œé¢å»ï¼Œå³å°†å•å‡»æŒ‰é’®äº‹ä»¶çš„Messageå…¥æ ˆåˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œç„¶åå†å°†å¹¿æ’­äº‹ä»¶çš„å°è£…æˆä»¥Messageï¼Œä¹Ÿå°†å…¶å…¥æ ˆåˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªMessageå¯¹è±¡è¡¨ç¤ºçš„æ˜¯çº¿ç¨‹éœ€è¦å¤„ç†çš„ä¸€ä»¶äº‹æƒ…ï¼Œæ¶ˆæ¯é˜Ÿåˆ—å°±æ˜¯ä¸€å †éœ€è¦å¤„ç†çš„Messageçš„æ± ã€‚çº¿ç¨‹Threadä¼šä¾æ¬¡å–å‡ºæ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ï¼Œä¾æ¬¡å¯¹å…¶è¿›è¡Œå¤„ç†ã€‚MessageQueueä¸­æœ‰ä¸¤ä¸ªæ¯”è¾ƒé‡è¦çš„æ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯enqueueMessageæ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯nextæ–¹æ³•ã€‚enqueueMessageæ–¹æ³•ç”¨äºå°†ä¸€ä¸ªMessageæ”¾å…¥åˆ°æ¶ˆæ¯é˜Ÿåˆ—MessageQueueä¸­ï¼Œnextæ–¹æ³•æ˜¯ä»æ¶ˆæ¯é˜Ÿåˆ—MessageQueueä¸­é˜»å¡å¼åœ°å–å‡ºä¸€ä¸ªMessageã€‚ enqueueMessageä¸»è¦æ“ä½œå…¶å®å°±æ˜¯å•é“¾è¡¨çš„æ’å…¥æ“ä½œï¼Œè¿™é‡Œå°±ä¸å†è¿‡å¤šè§£é‡Šäº†ã€‚è€Œnextæ–¹æ³•æ˜¯ä¸€ä¸ªæ— é™å¾ªç¯çš„æ–¹æ³•ï¼Œå¦‚æœæ¶ˆæ¯é˜Ÿåˆ—ä¸­æ²¡æœ‰æ¶ˆæ¯ï¼Œé‚£ä¹ˆnextæ–¹æ³•ä¼šä¸€ç›´é˜»å¡åœ¨è¿™é‡Œã€‚å½“æœ‰æ–°æ¶ˆæ¯åˆ°æ¥æ—¶ï¼Œnextæ–¹æ³•ä¼šè¿”å›è¿™æ¡æ¶ˆæ¯å¹¶å°†å…¶ä»å•é“¾è¡¨ä¸­ç§»é™¤ã€‚ 3. Looper1. Looperçš„åˆ›å»ºï¼ˆä½¿ç”¨ThreadLocalå­˜å‚¨ï¼‰Looperåœ¨Androidçš„æ¶ˆæ¯æœºåˆ¶ä¸­æ‰®æ¼”ç€æ¶ˆæ¯å¾ªç¯çš„è§’è‰²ï¼Œå…·ä½“æ¥è¯´å°±æ˜¯å®ƒä¼šä¸åœåœ°ä»MessageQueueä¸­æŸ¥çœ‹æ˜¯å¦æœ‰æ–°æ¶ˆæ¯ï¼Œå¦‚æœæœ‰æ–°æ¶ˆæ¯å°±ä¼šç«‹åˆ»å¤„ç†ï¼Œå¦åˆ™å°±ä¸€ç›´é˜»å¡åœ¨å“ªé‡Œã€‚é¦–å…ˆæ¥çœ‹ä¸€ä¸‹å®ƒçš„æ„é€ æ–¹æ³•ï¼Œåœ¨æ„é€ æ–¹æ³•ä¸­å®ƒä¼šåˆ›å»ºä¸€ä¸ªMessageQueueå³æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç„¶åå°†å½“å‰çº¿ç¨‹çš„å¯¹è±¡ä¿å­˜èµ·æ¥ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 12345678@UnsupportedAppUsagefinal MessageQueue mQueue;final Thread mThread;private Looper(boolean quitAllowed) &#123; mQueue = new MessageQueue(quitAllowed); mThread = Thread.currentThread();&#125; åˆ›å»ºlooperæ—¶è°ƒç”¨looper.prepareï¼Œå…·ä½“æ“ä½œï¼š 123456private static void prepare(boolean quitAllowed) &#123; if (sThreadLocal.get() != null) &#123; throw new RuntimeException("Only one Looper may be created per thread"); &#125; sThreadLocal.set(new Looper(quitAllowed));&#125; sThreadLocalå³ä¸ºå­˜å‚¨å„çº¿ç¨‹Looperçš„ThreadLocalå¯¹è±¡ï¼Œè°ƒç”¨å…¶getæ–¹æ³•åˆ¤æ–­è¯¥çº¿ç¨‹æ˜¯å¦å·²ç»æŒæœ‰äº†Looperï¼Œå¦‚æœå·²ç»æŒæœ‰åˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œè¿™æ˜¯ä¸ºäº†ä¿è¯å¯¹äºæ¯ä¸ªçº¿ç¨‹Looperçš„å”¯ä¸€æ€§ã€‚å¦‚æœæ²¡æœ‰Looperï¼Œåˆ™ä¸ºè¯¥çº¿ç¨‹åˆ›å»ºä¸€ä¸ªLooperã€‚ 2. Looperçš„å¾ªç¯è€ŒLooperæœ€é‡è¦çš„ä¸€ä¸ªæ–¹æ³•æ˜¯loopæ–¹æ³•ï¼Œåªæœ‰è°ƒç”¨äº†loopåï¼Œæ¶ˆæ¯å¾ªç¯ç³»ç»Ÿæ‰ä¼šçœŸæ­£åœ°èµ·ä½œç”¨ï¼Œå®ƒçš„å®ç°å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119/** * Run the message queue in this thread. Be sure to call * &#123;@link #quit()&#125; to end the loop. */ public static void loop() &#123; final Looper me = myLooper(); if (me == null) &#123; throw new RuntimeException("No Looper; Looper.prepare() wasn't called on this thread."); &#125; final MessageQueue queue = me.mQueue; // Make sure the identity of this thread is that of the local process, // and keep track of what that identity token actually is. Binder.clearCallingIdentity(); final long ident = Binder.clearCallingIdentity(); // Allow overriding a threshold with a system prop. e.g. // adb shell 'setprop log.looper.1000.main.slow 1 &amp;&amp; stop &amp;&amp; start' final int thresholdOverride = SystemProperties.getInt("log.looper." + Process.myUid() + "." + Thread.currentThread().getName() + ".slow", 0); boolean slowDeliveryDetected = false; for (;;) &#123; Message msg = queue.next(); // might block if (msg == null) &#123; // No message indicates that the message queue is quitting. return; &#125; // This must be in a local variable, in case a UI event sets the logger final Printer logging = me.mLogging; if (logging != null) &#123; logging.println("&gt;&gt;&gt;&gt;&gt; Dispatching to " + msg.target + " " + msg.callback + ": " + msg.what); &#125; // Make sure the observer won't change while processing a transaction. final Observer observer = sObserver; final long traceTag = me.mTraceTag; long slowDispatchThresholdMs = me.mSlowDispatchThresholdMs; long slowDeliveryThresholdMs = me.mSlowDeliveryThresholdMs; if (thresholdOverride &gt; 0) &#123; slowDispatchThresholdMs = thresholdOverride; slowDeliveryThresholdMs = thresholdOverride; &#125; final boolean logSlowDelivery = (slowDeliveryThresholdMs &gt; 0) &amp;&amp; (msg.when &gt; 0); final boolean logSlowDispatch = (slowDispatchThresholdMs &gt; 0); final boolean needStartTime = logSlowDelivery || logSlowDispatch; final boolean needEndTime = logSlowDispatch; if (traceTag != 0 &amp;&amp; Trace.isTagEnabled(traceTag)) &#123; Trace.traceBegin(traceTag, msg.target.getTraceName(msg)); &#125; final long dispatchStart = needStartTime ? SystemClock.uptimeMillis() : 0; final long dispatchEnd; Object token = null; if (observer != null) &#123; token = observer.messageDispatchStarting(); &#125; long origWorkSource = ThreadLocalWorkSource.setUid(msg.workSourceUid); try &#123; msg.target.dispatchMessage(msg); if (observer != null) &#123; observer.messageDispatched(token, msg); &#125; dispatchEnd = needEndTime ? SystemClock.uptimeMillis() : 0; &#125; catch (Exception exception) &#123; if (observer != null) &#123; observer.dispatchingThrewException(token, msg, exception); &#125; throw exception; &#125; finally &#123; ThreadLocalWorkSource.restore(origWorkSource); if (traceTag != 0) &#123; Trace.traceEnd(traceTag); &#125; &#125; if (logSlowDelivery) &#123; if (slowDeliveryDetected) &#123; if ((dispatchStart - msg.when) &lt;= 10) &#123; Slog.w(TAG, "Drained"); slowDeliveryDetected = false; &#125; &#125; else &#123; if (showSlowLog(slowDeliveryThresholdMs, msg.when, dispatchStart, "delivery", msg)) &#123; // Once we write a slow delivery log, suppress until the queue drains. slowDeliveryDetected = true; &#125; &#125; &#125; if (logSlowDispatch) &#123; showSlowLog(slowDispatchThresholdMs, dispatchStart, dispatchEnd, "dispatch", msg); &#125; if (logging != null) &#123; logging.println("&lt;&lt;&lt;&lt;&lt; Finished to " + msg.target + " " + msg.callback); &#125; // Make sure that during the course of dispatching the // identity of the thread wasn't corrupted. final long newIdent = Binder.clearCallingIdentity(); if (ident != newIdent) &#123; Log.wtf(TAG, "Thread identity changed from 0x" + Long.toHexString(ident) + " to 0x" + Long.toHexString(newIdent) + " while dispatching to " + msg.target.getClass().getName() + " " + msg.callback + " what=" + msg.what); &#125; msg.recycleUnchecked(); &#125; &#125; é€‰å–å…¶ä¸­æ¯”è¾ƒå…³é”®çš„éƒ¨åˆ†åšä¸€ä¸‹è®²è§£ï¼š final MessageQueue queue = me.mQueue; å˜é‡meæ˜¯é€šè¿‡é™æ€æ–¹æ³•myLooper()è·å¾—çš„å½“å‰çº¿ç¨‹æ‰€ç»‘å®šçš„Looperï¼Œme.mQueueæ˜¯å½“å‰çº¿ç¨‹æ‰€å…³è”çš„æ¶ˆæ¯ é˜Ÿåˆ—ã€‚ for (;;) æˆ‘ä»¬å‘ç°forå¾ªç¯æ²¡æœ‰è®¾ç½®å¾ªç¯ç»ˆæ­¢çš„æ¡ä»¶ï¼Œæ‰€ä»¥è¿™ä¸ªforå¾ªç¯æ˜¯ä¸ªæ­»å¾ªç¯ã€‚ Message msg = queue.next(); // might block æˆ‘ä»¬é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—MessageQueueçš„nextæ–¹æ³•ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–å‡ºä¸€æ¡æ¶ˆæ¯ï¼Œå¦‚æœæ­¤æ—¶æ¶ˆæ¯é˜Ÿåˆ—ä¸­æœ‰Messageï¼Œ é‚£ä¹ˆnextæ–¹æ³•ä¼šç«‹å³è¿”å›è¯¥Messageï¼Œå¦‚æœæ­¤æ—¶æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ²¡æœ‰Messageï¼Œé‚£ä¹ˆnextæ–¹æ³•å°±ä¼šé˜»å¡å¼åœ°ç­‰å¾…è· å–Messageã€‚ msg.target.dispatchMessage(msg); msgçš„targetå±æ€§æ˜¯Handlerï¼Œè¯¥ä»£ç çš„æ„æ€æ˜¯è®©Messageæ‰€å…³è”çš„Handleré€šè¿‡dispatchMessageæ–¹æ³•è®© Handlerå¤„ç†è¯¥Messageï¼Œå…³äºHandlerçš„dispatchMessageæ–¹æ³•å°†ä¼šåœ¨ä¸‹é¢è¯¦ç»†ä»‹ç»ã€‚ loopæ–¹æ³•æ˜¯ä¸€ä¸ªæ­»å¾ªç¯ï¼Œå”¯ä¸€è·³å‡ºå¾ªç¯çš„æ–¹å¼æ˜¯MessageQueueçš„nextæ–¹æ³•è¿”å›äº†nullã€‚ å½“Looperçš„quitæ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼ŒLooperå°±ä¼šè°ƒç”¨MessageQueueçš„quitæ–¹æ³•æˆ–quitSafelyæ–¹æ³•æ¥é€šçŸ¥æ¶ˆæ¯é˜Ÿåˆ—é€€å‡ºï¼Œå½“æ¶ˆæ¯é˜Ÿåˆ—è¢«æ ‡è®°ä¸ºé€€å‡ºçŠ¶æ€æ—¶ï¼Œå®ƒçš„nextæ–¹æ³•å°±ä¼šè¿”å›nullã€‚å¦‚æœMessageQueueçš„nextæ–¹æ³•è¿”å›äº†æ–°æ¶ˆæ¯ï¼ŒLooperå°±ä¼šå¤„ç†è¿™æ¡æ¶ˆæ¯ï¼š msg.target.dispatchMessage(msg)ï¼Œè¿™é‡Œçš„msg.targetæ˜¯å‘é€è¿™æ¡æ¶ˆæ¯çš„Handlerå¯¹è±¡ï¼Œè¿™æ ·Handlerå‘é€çš„æ¶ˆæ¯æœ€ç»ˆåˆäº¤ç»™å®ƒçš„dispatchMessageæ–¹æ³•æ¥å¤„ç†äº†ã€‚ä½†æ˜¯è¿™é‡Œä¸åŒçš„æ˜¯ï¼ŒHandlerçš„dispatchMessageæ–¹æ³•æ˜¯åœ¨åˆ›å»ºHandleræ—¶æ‰€ä½¿ç”¨çš„Looperä¸­æ‰§è¡Œçš„ï¼Œè¿™æ ·å°±æˆåŠŸçš„å°†ä»£ç é€»è¾‘åˆ‡æ¢åˆ°æŒ‡å®šçš„çº¿ç¨‹ä¸­å»æ‰§è¡Œäº†ã€‚ 4. Handler1. æ¶ˆæ¯å‘é€Handlerçš„å·¥ä½œä¸»è¦åŒ…å«æ¶ˆæ¯çš„å‘é€å’Œæ¥æ”¶è¿‡ç¨‹ã€‚æ¶ˆæ¯çš„å‘é€æœ€ç»ˆæ˜¯é€šè¿‡sendçš„ä¸€ç³»åˆ—æ–¹æ³•æ¥å®ç°çš„ã€‚å‘é€ä¸€æ¡æ¶ˆæ¯çš„å…¸å‹è¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š 12345678910111213141516171819202122232425262728293031public final boolean sendMessage(Message msg)&#123; return sendMessageDelayed(msg, 0);&#125;public final boolean sendMessageDelayed(Message msg, long delayMillis)&#123; if (delayMillis &lt; 0) &#123; delayMillis = 0; &#125; return sendMessageAtTime(msg, SystemClock.uptimeMillis() + delayMillis);&#125;public boolean sendMessageAtTime(Message msg, long uptimeMillis) &#123; MessageQueue queue = mQueue; if (queue == null) &#123; RuntimeException e = new RuntimeException( this + " sendMessageAtTime() called with no mQueue"); Log.w("Looper", e.getMessage(), e); return false; &#125; return enqueueMessage(queue, msg, uptimeMillis);&#125;private boolean enqueueMessage(MessageQueue queue, Message msg, long uptimeMillis) &#123; msg.target = this; if (mAsynchronous) &#123; msg.setAsynchronous(true); &#125; return queue.enqueueMessage(msg, uptimeMillis);&#125; åœ¨enqueueMessageä¸­æœ‰ä¸¤ä»¶äº‹éœ€è¦æ³¨æ„ï¼š msg.target = thisè¯¥ä»£ç å°†Messageçš„targetç»‘å®šä¸ºå½“å‰çš„Handler queue.enqueueMessageå˜é‡queueè¡¨ç¤ºçš„æ˜¯Handleræ‰€ç»‘å®šçš„æ¶ˆæ¯é˜Ÿåˆ—MessageQueueï¼Œé€šè¿‡è°ƒç”¨queue.enqueueMessage(msg, uptimeMillis)æˆ‘ä»¬å°†Messageæ”¾å…¥åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ã€‚ å…¶ä»–çš„ä¸€äº›è°ƒç”¨æœ€ç»ˆä¹Ÿéƒ½å½’ç»“åˆ°ä¸Šé¢è¿™ä¸ªæµç¨‹ä¸­ï¼š 2. æ¶ˆæ¯å¤„ç†é€šè¿‡ä¸Šæ–‡å¯ä»¥å‘ç°ï¼ŒHandlerå‘é€æ¶ˆæ¯çš„è¿‡ç¨‹ä»…ä»…æ˜¯å‘æ¶ˆæ¯é˜Ÿåˆ—æ’å…¥äº†ä¸€æ¡æ¶ˆæ¯ï¼ŒMessageQueueçš„nextæ–¹æ³•å°±ä¼šè¿”å›è¿™æ¡æ¶ˆæ¯ç»™Looperï¼ŒLooperæ”¶åˆ°æ¶ˆæ¯åå°±å¼€å§‹å¤„ç†äº†ï¼Œæœ€ç»ˆæ¶ˆæ¯ç”±Looperäº¤ç”±Handlerå¤„ç†ï¼Œå³Handlerçš„dispatchMessageæ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼Œè¿™æ—¶Handlerå°±è¿›å…¥äº†å¤„ç†æ¶ˆæ¯çš„é˜¶æ®µã€‚dispatchMessageçš„å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š 123456789101112public void dispatchMessage(Message msg) &#123; if (msg.callback != null) &#123; handleCallback(msg); &#125; else &#123; if (mCallback != null) &#123; if (mCallback.handleMessage(msg)) &#123; return; &#125; &#125; handleMessage(msg); &#125;&#125; å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæˆ‘ä»¬è®¾ç½®äº†callbackï¼ˆRunnableå¯¹è±¡ï¼‰çš„è¯ï¼Œåˆ™ä¼šç›´æ¥è°ƒç”¨handleCallbackæ–¹æ³• 123private static void handleCallback(Message message) &#123; message.callback.run();&#125; å³ï¼Œå¦‚æœæˆ‘ä»¬åœ¨åˆå§‹åŒ–Handlerçš„æ—¶å€™è®¾ç½®äº†callbackï¼ˆRunnableï¼‰å¯¹è±¡ï¼Œåˆ™ç›´æ¥è°ƒç”¨runæ–¹æ³•ã€‚æ¯”å¦‚æˆ‘ä»¬ç»å¸¸å†™çš„runOnUiThreadæ–¹æ³•ï¼š 1234567891011121314runOnUiThread(new Runnable() &#123; @Override public void run() &#123; &#125; &#125;);public final void runOnUiThread(Runnable action) &#123; if (Thread.currentThread() != mUiThread) &#123; mHandler.post(action); &#125; else &#123; action.run(); &#125;&#125; è€Œå¦‚æœmsg.callbackä¸ºç©ºçš„è¯ï¼Œä¼šç›´æ¥è°ƒç”¨æˆ‘ä»¬çš„mCallback.handleMessage(msg)ï¼Œå³handlerçš„handlerMessageæ–¹æ³•ã€‚handlerMessageæ–¹æ³•çš„æ‰§è¡Œä¹Ÿä¼šåœ¨åˆ›å»ºhandlerçš„çº¿ç¨‹ä¸­ã€‚ ç»¼ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°Handleræä¾›äº†ä¸‰ç§é€”å¾„å¤„ç†Messageï¼Œè€Œä¸”å¤„ç†æœ‰å‰åä¼˜å…ˆçº§ä¹‹åˆ†ï¼šé¦–å…ˆå°è¯•è®©postXXXä¸­ä¼ é€’çš„Runnableæ‰§è¡Œï¼Œå…¶æ¬¡å°è¯•è®©Handleræ„é€ å‡½æ•°ä¸­ä¼ å…¥çš„Callbackçš„handleMessageæ–¹æ³•å¤„ç†ï¼Œæœ€åæ‰æ˜¯è®©Handlerè‡ªèº«çš„handleMessageæ–¹æ³•å¤„ç†Messageã€‚ 3. postä¸sendçš„æ¯”è¾ƒä¸Šè¿°ä¾‹å­éƒ½æ˜¯ä½¿ç”¨sendæ–¹æ³•ï¼Œè¿™é‡ŒåŠ ä¸€ä¸ªpostçš„ä¾‹å­å¸®åŠ©ç†è§£handlerå¯¹äºä¸åŒç±»å‹ä¿¡æ¯çš„å¤„ç† é¦–å…ˆï¼Œè°ƒç”¨postæ–¹æ³•æ—¶ä¾ç„¶è°ƒç”¨äº†sendMessageDelayedï¼Œä½†æ˜¯å€¼å¾—æ³¨æ„çš„æ˜¯è¿™é‡Œçš„å‚æ•°æœ‰æ‰€ä¸åŒï¼Œä½¿ç”¨äº†getPostMessage(r)ä½œä¸ºå‚æ•°ã€‚ 1234public final boolean post(Runnable r) &#123; return sendMessageDelayed(getPostMessage(r), 0);//getPostMessageæ–¹æ³•æ˜¯ä¸¤ç§å‘é€æ¶ˆæ¯çš„ä¸åŒä¹‹å¤„ &#125; é‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹ä¸€çœ‹ğŸ‘€è¿™ä¸ªgetPostMessageæ–¹æ³•ï¼š 12345private static Message getPostMessage(Runnable r) &#123; Message m = Message.obtain(); m.callback = r; return m; &#125; å¯ä»¥çœ‹åˆ°ï¼Œä¾ç„¶æ˜¯æŠŠRunnableå¯¹è±¡å°è£…æˆäº†ä¸€ä¸ªMessageè¿›è¡Œå‘é€ï¼Œä¸è¿‡è¿™é‡Œè®¾ç½®äº†m.callback = r ï¼Œè¿™ä¹Ÿå‘¼åº”äº†ä¸Šæ–‡ä¸­æåˆ°çš„ï¼Œå¦‚æœæˆ‘ä»¬åœ¨åˆå§‹åŒ–Handlerçš„æ—¶å€™è®¾ç½®äº†callbackï¼ˆRunnableï¼‰å¯¹è±¡ï¼Œåˆ™ç›´æ¥è°ƒç”¨runæ–¹æ³•ã€‚ 4. Callback12345678910/** * Callback interface you can use when instantiating a Handler to avoid * having to implement your own subclass of Handler. * * @param msg A &#123;@link android.os.Message Message&#125; object * @return True if no further handling is desired */public interface Callback &#123; public boolean handleMessage(Message msg);&#125; Handler.Callbackæ˜¯ç”¨æ¥å¤„ç†Messageçš„ä¸€ç§æ‰‹æ®µï¼Œå¦‚æœæ²¡æœ‰ä¼ é€’è¯¥å‚æ•°ï¼Œé‚£ä¹ˆå°±åº”è¯¥é‡å†™Handlerçš„handleMessageæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸ºäº†ä½¿å¾—Handlerèƒ½å¤Ÿå¤„ç†Messageï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§åŠæ³•ï¼š å‘Hanlderçš„æ„é€ å‡½æ•°ä¼ å…¥ä¸€ä¸ªHandler.Callbackå¯¹è±¡ï¼Œå¹¶å®ç°Handler.Callbackçš„handleMessageæ–¹æ³• æ— éœ€å‘Hanlderçš„æ„é€ å‡½æ•°ä¼ å…¥Handler.Callbackå¯¹è±¡ï¼Œä½†æ˜¯éœ€è¦é‡å†™Handleræœ¬èº«çš„handleMessageæ–¹æ³• ä¹Ÿå°±æ˜¯è¯´æ— è®ºå“ªç§æ–¹å¼ï¼Œæˆ‘ä»¬éƒ½å¾—é€šè¿‡æŸç§æ–¹å¼å®ç°handleMessageæ–¹æ³•ï¼Œè¿™ç‚¹ä¸Javaä¸­å¯¹Threadçš„è®¾è®¡æœ‰å¼‚æ›²åŒå·¥ä¹‹å¤„ã€‚ åœ¨Javaä¸­ï¼Œå¦‚æœæˆ‘ä»¬æƒ³ä½¿ç”¨å¤šçº¿ç¨‹ï¼Œæœ‰ä¸¤ç§åŠæ³•ï¼š å‘Threadçš„æ„é€ å‡½æ•°ä¼ å…¥ä¸€ä¸ªRunnableå¯¹è±¡ï¼Œå¹¶å®ç°Runnableçš„runæ–¹æ³• æ— éœ€å‘Threadçš„æ„é€ å‡½æ•°ä¼ å…¥Runnableå¯¹è±¡ï¼Œä½†æ˜¯è¦é‡å†™Threadæœ¬èº«çš„runæ–¹æ³• 5. æ€»ç»“ åœ¨ä½¿ç”¨handlerçš„æ—¶å€™ï¼Œåœ¨handleræ‰€åˆ›å»ºçš„çº¿ç¨‹éœ€è¦ç»´æŠ¤ä¸€ä¸ªå”¯ä¸€çš„Looperå¯¹è±¡ï¼Œ æ¯ä¸ªçº¿ç¨‹å¯¹åº”ä¸€ä¸ªLooperï¼Œæ¯ä¸ªçº¿ç¨‹çš„Looperé€šè¿‡ThreadLocalæ¥ä¿è¯ Looperå¯¹è±¡çš„å†…éƒ¨åˆç»´æŠ¤æœ‰å”¯ä¸€çš„ä¸€ä¸ªMessageQueueï¼Œæ‰€ä»¥ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æœ‰å¤šä¸ªhandlerï¼Œä½†æ˜¯åªèƒ½æœ‰ä¸€ä¸ªLooperå’Œä¸€ä¸ªMessageQueueã€‚ Messageåœ¨MessageQueueä¸æ˜¯é€šè¿‡ä¸€ä¸ªåˆ—è¡¨æ¥å­˜å‚¨çš„ï¼Œè€Œæ˜¯å°†ä¼ å…¥çš„Messageå­˜å…¥åˆ°äº†ä¸Šä¸€ä¸ªMessageçš„nextä¸­ï¼Œåœ¨å–å‡ºçš„æ—¶å€™é€šè¿‡é¡¶éƒ¨çš„Messageå°±èƒ½æŒ‰æ”¾å…¥çš„é¡ºåºä¾æ¬¡å–å‡ºMessageã€‚ Looperå¯¹è±¡é€šè¿‡loop()æ–¹æ³•å¼€å¯äº†ä¸€ä¸ªæ­»å¾ªç¯ï¼Œä¸æ–­åœ°ä»looperå†…çš„MessageQueueä¸­å–å‡ºMessageï¼Œç„¶åé€šè¿‡handlerå°†æ¶ˆæ¯åˆ†å‘ä¼ å›handleræ‰€åœ¨çš„çº¿ç¨‹ã€‚ handleræ”¶åˆ°æ¶ˆæ¯ä»¥åï¼Œé€šè¿‡handleMessageè¿›è¡Œæ¶ˆæ¯å¤„ç† 6. è¡¥å……ï¼šèµ„æºç®¡ç†ä¸å†…å­˜æ³„æ¼1. Handlerçš„å†…å­˜æ³„æ¼é—®é¢˜Handlerä½¿ç”¨æ˜¯ç”¨æ¥è¿›è¡Œçº¿ç¨‹é—´é€šä¿¡çš„ï¼Œæ‰€ä»¥æ–°å¼€å¯çš„çº¿ç¨‹ä¼šæŒæœ‰Handlerå¼•ç”¨ï¼Œå¦‚æœåœ¨Activityç­‰ä¸­åˆ›å»ºHandlerï¼Œå¹¶ä¸”æ˜¯éé™æ€å†…éƒ¨ç±»çš„å½¢å¼ï¼Œå°±æœ‰å¯èƒ½é€ æˆå†…å­˜æ³„æ¼ã€‚ é¦–å…ˆï¼Œéé™æ€å†…éƒ¨ç±»æ˜¯ä¼šéšå¼æŒæœ‰å¤–éƒ¨ç±»çš„å¼•ç”¨ï¼Œæ‰€ä»¥å½“å…¶ä»–çº¿ç¨‹æŒæœ‰äº†è¯¥Handlerï¼Œçº¿ç¨‹æ²¡æœ‰è¢«é”€æ¯ï¼Œåˆ™æ„å‘³ç€Activityä¼šä¸€ç›´è¢«HandleræŒæœ‰å¼•ç”¨è€Œæ— æ³•å¯¼è‡´å›æ”¶ã€‚ åŒæ—¶ï¼ŒMessageQueueä¸­å¦‚æœå­˜åœ¨æœªå¤„ç†å®Œçš„Messageï¼ŒMessageçš„targetä¹Ÿæ˜¯å¯¹Activityç­‰çš„æŒæœ‰å¼•ç”¨ï¼Œä¹Ÿä¼š é€ æˆå†…å­˜æ³„æ¼ã€‚ è§£å†³çš„åŠæ³•ï¼š ä½¿ç”¨é™æ€å†…éƒ¨ç±»+å¼±å¼•ç”¨çš„æ–¹å¼: é™æ€å†…éƒ¨ç±»ä¸ä¼šæŒæœ‰å¤–éƒ¨ç±»çš„çš„å¼•ç”¨ï¼Œå½“éœ€è¦å¼•ç”¨å¤–éƒ¨ç±»ç›¸å…³æ“ä½œæ—¶ï¼Œå¯ä»¥é€šè¿‡å¼±å¼•ç”¨è¿˜è·å–åˆ°å¤–éƒ¨ç±»ç›¸å…³æ“ä½œï¼Œå¼±å¼•ç”¨ä¸ä¼šé€ æˆå¯¹è±¡è¯¥å›æ”¶å›æ”¶ä¸æ‰çš„é—®é¢˜ã€‚ 1234567891011121314151617private Handler sHandler = new TestHandler(this);static class TestHandler extends Handler &#123; private WeakReference&lt;Activity&gt; mActivity; TestHandler(Activity activity) &#123; mActivity = new WeakReference&lt;&gt;(activity); &#125; @Override public void handleMessage(Message msg) &#123; super.handleMessage(msg); Activity activity = mActivity.get(); if (activity != null) &#123; //TODO: &#125; &#125;&#125; åœ¨å¤–éƒ¨ç±»å¯¹è±¡è¢«é”€æ¯æ—¶ï¼Œå°†MessageQueueä¸­çš„æ¶ˆæ¯æ¸…ç©ºã€‚ä¾‹å¦‚ï¼Œåœ¨Activityçš„onDestroyæ—¶å°†æ¶ˆæ¯æ¸…ç©ºã€‚ 12345@Overrideprotected void onDestroy() &#123; handler.removeCallbacksAndMessages(null); super.onDestroy();&#125; 2. åˆ›å»ºMessageæ—¶çš„èµ„æºç®¡ç†ä½¿ç”¨Handler.obtainMessage()æ¥è·å–Messageå¯¹è±¡çš„ï¼Œå’Œç›´æ¥newä¸€ä¸ªMessageæœ‰ä»€ä¹ˆå·®åˆ«å‘¢ï¼Ÿ 12Message message = handler.obtainMessage();Message message = new Message(); çœ‹ä¸€çœ‹obtainçš„ä»£ç ï¼š 12345678910111213public static Message obtain() &#123; synchronized (sPoolSync) &#123; if (sPool != null) &#123; Message m = sPool; sPool = m.next; m.next = null; m.flags = 0; // clear in-use flag sPoolSize--; return m; &#125; &#125; return new Message(); &#125; åœ¨Messageä¸­æœ‰ä¸€ä¸ªstatic Messageå˜é‡sPoolï¼Œè¿™ä¸ªå˜é‡æ˜¯ç”¨äºç¼“å­˜Messageå¯¹è±¡çš„ï¼Œåœ¨obtainä¸­å¯ä»¥çœ‹åˆ°å½“éœ€è¦ä¸€ä¸ªMessageå¯¹è±¡æ—¶ï¼Œå¦‚æœsPoolä¸ä¸ºç©ºåˆ™ä¼šè¿”å›å½“å‰sPoolï¼ˆMessageï¼‰ï¼Œè€Œå°†sPoolæŒ‡å‘äº†ä¹‹å‰sPoolçš„nextå¯¹è±¡ï¼Œï¼ˆä¹‹å‰è®²MessageQueueæ—¶è®²è¿‡Messageçš„å­˜å‚¨æ˜¯ä»¥é“¾å¼çš„å½¢å¼å­˜å‚¨çš„ï¼Œé€šè¿‡Messageçš„nextæŒ‡å‘ä¸‹ä¸€ä¸ªMessageï¼Œè¿™é‡Œå°±æ˜¯è¿”å›äº†sPoolå½“å‰è¿™ä¸ªMessageï¼Œç„¶åsPoolé‡æ–°æŒ‡å‘äº†å…¶ä¸‹ä¸€ä¸ªMessageï¼‰ï¼Œç„¶åå°†è¿”å›çš„Messageçš„nextæŒ‡å‘ç½®ä¸ºç©ºï¼ˆæ–­å¼€é“¾è¡¨ï¼‰ï¼ŒsPoolSizeè®°å½•äº†å½“å‰ç¼“å­˜çš„Messageçš„æ•°é‡ï¼Œå¦‚æœsPoolä¸ºç©ºï¼Œåˆ™æ²¡æœ‰ç¼“å­˜çš„Messageï¼Œåˆ™éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„Messageï¼ˆnew Messageï¼‰ã€‚ é‚£ä¹ˆï¼Œç¼“å­˜ä¸­çš„sPoolæ˜¯å“ªé‡Œæ¥çš„å‘¢ 12345678910111213141516171819202122232425262728293031323334public void recycle() &#123; if (isInUse()) &#123; if (gCheckRecycle) &#123; throw new IllegalStateException("This message cannot be recycled because it " + "is still in use."); &#125; return; &#125; recycleUnchecked(); &#125;void recycleUnchecked() &#123; // Mark the message as in use while it remains in the recycled object pool. // Clear out all other details. flags = FLAG_IN_USE; what = 0; arg1 = 0; arg2 = 0; obj = null; replyTo = null; sendingUid = -1; when = 0; target = null; callback = null; data = null; synchronized (sPoolSync) &#123; if (sPoolSize &lt; MAX_POOL_SIZE) &#123; next = sPool; sPool = this; sPoolSize++; &#125; &#125; &#125; recycle()æ˜¯å›æ”¶Messageçš„æ–¹æ³•,åœ¨Messageå¤„ç†å®Œæˆ–è€…æ¸…ç©ºMessageç­‰æ—¶ä¼šè°ƒç”¨ã€‚recycleUncheckedï¼ˆï¼‰æ–¹æ³•ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå°†whatã€arg1ã€arg2ã€objectç­‰éƒ½é‡ç½®äº†å€¼ï¼Œå¦‚æœå½“å‰sPoolï¼ˆMessageç¼“å­˜æ± ï¼‰çš„å¤§å°å°äºå…è®¸ç¼“å­˜çš„Messageæœ€å¤§æ•°é‡æ—¶ï¼Œå°†è¦å›æ”¶çš„Messageçš„nextæŒ‡å‘sPoolï¼Œå°†sPoolæŒ‡å‘äº†å›æ”¶çš„Messageå¯¹è±¡ï¼ˆå³å°†Messageæ”¾åˆ°äº†sPoolç¼“å­˜æ± çš„å¤´éƒ¨ï¼‰ 7. å‚è€ƒæ–‡ç« è¿™äº›æ˜¯æˆ‘åœ¨å‡†å¤‡å’Œå­¦ä¹ è¿‡ç¨‹ä¸­å‚è€ƒçš„ä¸€äº›åšå®¢ï¼Œå¤§å®¶æœ‰å…´è¶£å¯ä»¥è‡ªå·±å†åº·åº·ğŸ‘€ Androidæ¶ˆæ¯æœºåˆ¶ï¼š https://www.jianshu.com/p/7653adc038c6 Androidæ¶ˆæ¯æœºåˆ¶ï¼š https://blog.csdn.net/wsq_tomato/article/details/80301851?depth_1-utm_source=distribute.pc_relevant.none-task&amp;utm_source=distribute.pc_relevant.none-task Handler.post: https://blog.csdn.net/ly502541243/article/details/52062179?depth_1-utm_source=distribute.pc_relevant.none-task&amp;utm_source=distribute.pc_relevant.none-task post()å’ŒpostDelay()æ–¹æ³•ç²¾ç‚¼è¯¦è§£ï¼š https://blog.csdn.net/weixin_41101173/article/details/79701832 ä½ çœŸçš„äº†è§£Handlerï¼Ÿï¼š https://blog.csdn.net/qian520ao/article/details/78262289?depth_1-utm_source=distribute.pc_relevant.none-task&amp;utm_source=distribute.pc_relevant.none-task æ·±å…¥æºç è§£æAndroidä¸­çš„Handler,Message,MessageQueue,Looperï¼šhttps://blog.csdn.net/iispring/article/details/47180325]]></content>
      <categories>
        <category>Androidå¼€å‘</category>
      </categories>
      <tags>
        <tag>AndroidçŸ¥è¯†</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[CentOSæ­å»ºApacheæœåŠ¡å™¨å’ŒftpæœåŠ¡å™¨]]></title>
    <url>%2Fdesirelife6.github.io%2F2019%2F11%2F13%2F%E5%9C%A8CentOS%E7%8E%AF%E5%A2%83%E4%B8%8B%E6%90%AD%E5%BB%BAApache%E6%9C%8D%E5%8A%A1%E5%99%A8%E2%80%94%E2%80%94%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%2F</url>
    <content type="text"><![CDATA[CentOSæ­å»ºApacheæœåŠ¡å™¨å’ŒftpæœåŠ¡å™¨[TOC] 1. Apacheå®‰è£…ä½¿ç”¨su rootå¾—åˆ°æƒé™åä½¿ç”¨yum install httpdå®‰è£…ApacheæœåŠ¡å™¨ ä½¿ç”¨rpm -qa | grep httpdè¿›è¡ŒéªŒè¯ï¼Œå¯è§å·²ç»å®‰è£…å®Œæˆ 2. æ£€éªŒç½‘ç»œçš„è¿é€šæ€§ç”±ä¸‹å›¾å¯çŸ¥ç½‘ç»œè¿é€šæ€§è‰¯å¥½ 3. å¯åŠ¨apacheæœåŠ¡å™¨ï¼Œç„¶åç”¨å®¢æˆ·æœºç«¯è®¿é—®é»˜è®¤ç•Œé¢å’Œä¸ªäººç•Œé¢3.1 å¯åŠ¨apacheæœåŠ¡ï¼Œè®¿é—®é»˜è®¤ç•Œé¢ä½¿ç”¨systemctl start httpdå¯åŠ¨apacheæœåŠ¡å¹¶ä½¿ç”¨systemctl stop firewalldå…³é—­é˜²ç«å¢™ ä½¿ç”¨æµè§ˆå™¨è®¿é—®ï¼Œè®¿é—®æ­£å¸¸ è¿›å…¥var/www/htmlæ–‡ä»¶å¤¹ä¸‹æ–°å»ºindex.htmlï¼Œä¿®æ”¹é»˜è®¤ä¸»é¡µåå†æ¬¡è®¿é—® 3.2 åˆ›å»ºç”¨æˆ·ä¸ªäººç•Œé¢åœ¨ç”¨æˆ·desirelifeç›®å½•ä¸‹æ–°å»ºpublic_htmlç›®å½•ï¼Œå¹¶ä¿®æ”¹å…¶æƒé™ å†™å…¥ä¸ªäººä¸»é¡µçš„index.htmlï¼Œå†…å®¹ä¸ºä¸€è¡Œå­—ï¼š â€œThis is Desirelifeâ€™s webâ€ å¾—åˆ°rootæƒé™å¹¶ä¿®æ”¹/etc/httpd/conf.d/userdiræ–‡ä»¶ï¼Œå…è®¸ç”¨æˆ·æ¶è®¾ä¸ªäººwebç«™ç‚¹ã€‚ SELLinuxæ¨¡å¼æœ‰æ—¶ä¼šé˜»ç¢å®¢æˆ·æœºçš„è®¿é—®ï¼Œå› æ­¤æˆ‘ä»¬ä½¿ç”¨setenforceå‘½ä»¤æŠŠSELLinuxè®¾ç½®ä¸ºå…è®¸æ¨¡å¼ï¼Œgetenforceå‘½ä»¤æŸ¥çœ‹è®¾ç½®åçš„SELLinuxæ¨¡å¼ã€‚ ç„¶åé‡å¯æœåŠ¡ï¼Œåœ¨å®¢æˆ·æœºç«¯è¿›è¡Œè®¿é—®ã€‚ 4. é…ç½®è™šæ‹Ÿä¸»æœº åˆ†åˆ«ç»™ç½‘å¡é…ç½®ä¸¤ä¸ªipåœ°å€23.17.235å’Œ172.23.17.233ï¼ˆè¿™é‡Œçš„IPåœ°å€éœ€è¦å’Œè™šæ‹Ÿæœºä¸Šçš„IPåœ°å€ç½‘æ®µä¿æŒä¸€è‡´ï¼‰ è™šæ‹Ÿæœºä¸Šçš„ipåœ°å€å¦‚å›¾1æ‰€ç¤ºï¼Œä¸º192.168.159.128 åˆ†åˆ«åˆ›å»ºâ€œ/var/www/ip4â€å’Œâ€œ/var/www/ip5â€ä¸¤ä¸ªä¸»ç›®å½•å’Œé»˜è®¤é¦–é¡µæ–‡ä»¶ã€‚ åœ¨/etc/httpd/conf/httpd.confæ–‡ä»¶ä¸­ï¼Œè®¾ç½®åŸºäºIPåœ°å€çš„è™šæ‹Ÿä¸»æœºï¼Œé…ç½®å†…å®¹å¦‚ä¸‹ é‡å¯æœåŠ¡åå†åœ¨å®¢æˆ·ç«¯è®¿é—®ï¼Œå¯åœ¨å®¢æˆ·ç«¯è¾“å…¥http://IPå½¢å¼çš„URLåœ°å€è®¿é—®è™šæ‹Ÿä¸»æœºï¼Œåˆ™å¯ä»¥è®¿é—®å¯¹åº”çš„è™šæ‹Ÿä¸»æœºã€‚ 5. vsftpdçš„å®‰è£…å’Œé…ç½®5.1 å®‰è£…ftpæœåŠ¡ä½¿ç”¨yumè½¯ä»¶ç®¡ç†åŒ…å®‰è£…ftpæœåŠ¡ æŸ¥è¯¢å·²å®‰è£…çš„è½¯ä»¶è¿‡æ»¤å‡ºvsftpdï¼Œå¯çŸ¥å®‰è£…æˆåŠŸ 5.2 å¯åŠ¨ftpæœåŠ¡å¯åŠ¨ä»¥åç›´æ¥ç”¨localhostç™»å½•ï¼Œå‘ç°ä¸æœåŠ¡å™¨çš„è¿æ¥æ–­å¼€ï¼Œå¦‚å›¾æ‰€ç¤º è¿™æ˜¯å› ä¸ºVSFTPDæ˜¯ä¸€ä¸ªFTPæœåŠ¡å™¨ç¨‹åºï¼ŒSELinuxæ˜¯CentOSçš„é˜²ç«å¢™ç»„ä»¶ï¼Œ vsftpd é»˜è®¤è¢« SELinux æ‹¦æˆªã€‚å¯ä»¥é€šè¿‡åœ¨linuxä¸­è®¾ç½®ftpå…è®¸è®¿é—®è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å¦‚å›¾æ‰€ç¤ºï¼Œå°†ftpd_full_accessè®¾ç½®ä¸ºon é…ç½®æ–‡ä»¶å…è®¸åŒ¿åè®¿é—®ç­‰ å¯åŠ¨æœåŠ¡ï¼Œæ­¤æ—¶å¯ä»¥é€šè¿‡ipåœ°å€è®¿é—®æœåŠ¡å™¨ï¼ŒæŸ¥è¯¢ftpæœåŠ¡çš„çŠ¶æ€ï¼Œå¯è§å·²ç»å¤„äºactiveçŠ¶æ€ æŸ¥è¯¢21ç«¯å£ åœ¨æœ¬åœ°ä½¿ç”¨anonymousåŒ¿åç™»é™†è¿›è¡ŒéªŒè¯ï¼Œä¿è¯è¿”å›220è¡¨ç¤ºæœåŠ¡æ­£å¸¸ï¼Œ230è¡¨ç¤ºç™»é™†æˆåŠŸ ä½¿ç”¨å®¢æˆ·æœºï¼Œç”¨ipè¿›è¡Œè®¿é—®ï¼Œå¯ä»¥çœ‹åˆ°ç³»ç»Ÿé¢„è®¾çš„pubæ–‡ä»¶å¤¹ï¼Œè¡¨ç¤ºè®¿é—®æ­£å¸¸ 5.3 åˆ›å»ºftpç”¨æˆ· åœ¨centosæ·»åŠ ç”¨æˆ·ftpuserï¼Œå¹¶è®¾ç½®å¯†ç ï¼ˆè¿™é‡Œç”±äºå¯†ç è®¾ç½®è¿‡äºç®€å•è¢«è¿«è®¾ç½®äº†å¥½å‡ æ¬¡XDï¼‰ï¼Œé™åˆ¶è¯¥ç”¨æˆ·çš„ç™»é™† åˆ›å»ºç”¨æˆ·ç›®å½•å¹¶æŒ‡å®šç‰¹å®šç”¨æˆ·çš„ç™»é™†ç›®å½•]]></content>
      <categories>
        <category>è¯¾ç¨‹ä½œä¸š</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>è®¡ç®—æœºç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç®€æ˜“å¾®ä¿¡å¼€å‘ç™½çš®ä¹¦]]></title>
    <url>%2Fdesirelife6.github.io%2F2019%2F11%2F03%2F%E7%AE%80%E6%98%93%E5%BE%AE%E4%BF%A1%E5%BC%80%E5%8F%91%E7%99%BD%E7%9A%AE%E4%B9%A6%2F</url>
    <content type="text"><![CDATA[ç®€æ˜“å¾®ä¿¡å¼€å‘ç™½çš®ä¹¦[TOC] 1. è½¯ä»¶æ¦‚å†µå±•ç¤º1.1 åŠŸèƒ½å±•ç¤ºï¼ˆæˆªå›¾é™„äºæ–‡æœ«ï¼‰ åŸºç¡€åŠŸèƒ½ 1ï¼‰ æ³¨å†Œã€ç™»é™†ã€ç™»å‡º(åŒ…å«æ˜¯å¦å·²æ³¨å†Œã€é‡ååˆ¤æ–­ç­‰) 2ï¼‰ æ·»åŠ ã€åˆ é™¤å¥½å‹ 3ï¼‰ å¥½å‹åˆ—è¡¨å±•ç¤º 4ï¼‰ å®æ—¶çš„æ–°æ¶ˆæ¯æé†’å’Œæ”¶å‘æ¶ˆæ¯ï¼ˆåŒ…å«å¯¹æ˜¯å¦å¥½å‹ï¼Œå¥½å‹åœ¨çº¿çŠ¶æ€çš„åˆ¤æ–­ï¼‰ 5ï¼‰ æ”¯æŒå¯¹æ–‡ä»¶ï¼Œå›¾ç‰‡çš„å‘é€å’Œæ¥æ”¶ æ‹“å±•åŠŸèƒ½ 6ï¼‰ ä¿å­˜èŠå¤©è®°å½• 7ï¼‰ å®æ—¶å¼¹çª—æé†’ç”¨æˆ·æ”¶åˆ°æ–°æ¶ˆæ¯ï¼Œå¹¶å±•ç¤ºå‘é€æ–¹å’Œæ¶ˆæ¯é¢„è§ˆ 8ï¼‰ ç¼“å­˜èŠå¤©å†…å®¹ï¼Œå¯ä»¥ä¿å­˜æœªè¯»çš„èŠå¤©è®°å½• 9ï¼‰ æœåŠ¡å™¨ä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€ä¿¡æ¯ï¼ˆTCPé•¿è¿æ¥ï¼Œæ¨¡æ‹Ÿå®ç°åŒå·¥é€šä¿¡ï¼‰ 10ï¼‰ ä½¿ç”¨tokenè¿›è¡Œç”¨æˆ·èº«ä»½éªŒè¯ï¼Œé™¤å¯†ç éªŒè¯å¤–æä¾›å¤šä¸€å±‚çš„å®‰å…¨ä¿éšœ 11ï¼‰ UIç¾åŒ–ï¼Œæ¶ˆæ¯æ°”æ³¡å¤§å°åŠ¨æ€å˜åŒ– 12ï¼‰ å±•ç¤ºç”¨æˆ·ä¿¡æ¯ï¼Œå¦‚ç”¨æˆ·åï¼Œå¤´åƒç­‰ 1.2 å¥å£®æ€§åŠå¼‚å¸¸æƒ…å†µå¤„ç†å±•ç¤º1ï¼‰ æ£€æµ‹å¹¶é˜»æ­¢é‡å¤æ³¨å†Œæˆ–ç™»é™† 2ï¼‰ æ£€æµ‹ç”¨æˆ·çš„åœ¨çº¿çŠ¶æ€ 3ï¼‰ æ£€æŸ¥ç”¨æˆ·çš„å¥½å‹åˆ—è¡¨åŠå¥½å‹å…³ç³» 2. è½¯ä»¶æ•´ä½“ç³»ç»Ÿæ¶æ„åˆ†æ2.1 æ•´ä½“ï¼šå‰åç«¯åˆ†ç¦» ç®€æ˜“å¾®ä¿¡æ•´ä½“å‰åç«¯åˆ†ç¦» æœåŠ¡å™¨çš„å¼€å‘è¯­è¨€ä¸º javaï¼Œå¼€å‘å·¥å…·ä¸º intelliJ Ideaï¼› å®¢æˆ·ç«¯çš„å¼€å‘è¯­è¨€ä¸º kotlinï¼Œ å¼€å‘å·¥å…·ä¸º Android Studioã€‚ æœåŠ¡å™¨éƒ¨ç½²åœ¨æœ¬æœºï¼Œä¸å„å®¢æˆ·ç«¯é‡‡ç”¨socketè¿æ¥ï¼ŒC/Sæ¨¡å¼ã€‚UMLå›¾å¦‚ä¸‹ï¼š 2.2 æœåŠ¡å™¨ç«¯ï¼šJDBC, Socket, Thread, PostgreSql é‡‡ç”¨JDBCç®¡ç†åº•å±‚æ•°æ®åº“ï¼Œåº•å±‚é‡‡ç”¨postgreSqlæ•°æ®åº“å­˜å‚¨å¿…è¦çš„ä¿¡æ¯ ä½¿ç”¨ javaç»“åˆsqlè¯­å¥æ“ä½œæ•°æ®åº“ï¼Œå®ç°å¯¹ä¿¡æ¯çš„å¢åˆ æŸ¥æ”¹ã€‚ é‡‡ç”¨Socketè¿æ¥å®ç°ä¸å®¢æˆ·ç«¯çš„è¿æ¥ä¸é€šä¿¡ï¼Œä»è€Œæˆä¸ºæ²Ÿé€šå®¢æˆ·ç«¯çš„ä¸­æ¢ï¼Œå…¸å‹çš„C/Sã€‚ é‡‡ç”¨å¤šçº¿ç¨‹å¼€å¯socketé€šä¿¡ï¼Œä½¿ç”¨ç»Ÿä¸€çš„Serverå’ŒMapè¿›è¡Œç®¡ç† é‡å†™javaçš„Tupleç±»ï¼Œä»¥å®ç°æœåŠ¡å™¨çš„å¤šè¿”å›å€¼ 2.3 å®¢æˆ·ç«¯ï¼šMVPã€Fragmentã€Json ä½¿ç”¨ kotlinå¼€å‘ï¼ŒMVPæŠ€æœ¯æ¶æ„ã€‚æ•°æ®å±‚(model)ã€æ•°æ®å¤„ç†å±‚(presenter)ã€ç”¨æˆ·äº¤äº’å±‚(view)é«˜åº¦è§£è€¦ï¼Œä½¿å¾—æ•°æ®å¤„ç†å’Œç”¨æˆ·äº¤äº’æ›´åŠ ä¼˜é›… ä¸»ç•Œé¢é‡‡ç”¨ViewPager+Fragmentï¼Œå¯ä»¥è½»æ¾åœ¨å„ç•Œé¢é—´æ»‘åŠ¨ æ¯é¡¹æ“ä½œéƒ½æä¾›åé¦ˆï¼Œå®æ—¶æ¥æ”¶æœåŠ¡å™¨æ¶ˆæ¯ è‡ªå®šæ•°æ®ã€åè®®æ ¼å¼ï¼Œå€Ÿé‰´ç›®å‰å¸¸ç”¨çš„Jsonæ ¼å¼ å¿«é€Ÿã€ç¨³å®šçš„å›¾ç‰‡ä¼ è¾“ 3. è‡ªå®šä¹‰åè®®åˆ†æ3.1 ä¼ è¾“åè®®åŠæ ¼å¼ç®€æ˜“å¾®ä¿¡serverç«¯é‡‡ç”¨TCPä½œä¸ºä¼ è¾“å±‚åè®®ï¼Œhttpä½œä¸ºåº”ç”¨å±‚åè®®ï¼Œå¹¶å¯¹httpçš„åè®®æ ¼å¼å’ŒæŠ¥æ–‡æ ¼å¼è¿›è¡Œè‡ªå®šä¹‰ä¿®æ”¹ï¼ŒæŠ¥æ–‡é‡‡ç”¨ json æ ¼å¼æ•°æ®æ–‡æ¡£å®ç°serverä¸clienté—´çš„é€šä¿¡ã€‚ 3.2 ç½‘ç»œè¿æ¥ æœåŠ¡å™¨æ­å»ºåœ¨æœ¬åœ°ï¼Œç›‘å¬12000ç«¯å£ï¼Œæœ¬æœºè®¿é—®æœåŠ¡å™¨ä½¿ç”¨ ipä¸º127.0.0.1ï¼Œå…¶ä½™å®¢æˆ·ç«¯è®¿é—®æœåŠ¡å™¨æ—¶åœ°å€é‡‡ç”¨æœ¬æœº ipã€‚æœåŠ¡å™¨ç¨‹åºä¼šä¸€ç›´ç›‘å¬å‘èµ·è¯·æ±‚çš„å®¢æˆ·ç«¯ï¼Œä¸ä¹‹ä¿æŒè¿æ¥çŠ¶æ€ï¼Œç›´åˆ°å®¢æˆ·ç«¯ä¸»åŠ¨æ–­å¼€è¿æ¥ã€‚åœ¨æ­¤æœŸé—´ï¼ŒæœåŠ¡å™¨ä¸å®¢æˆ·ç«¯é—´çš„è¾“å…¥è¾“å‡ºæµå°†ä¿æŒã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¯æ¬¡æœåŠ¡å™¨é‡å¯ä¼šå¼ºåˆ¶ç™»å‡ºæ‰€æœ‰ç”¨æˆ·ã€‚ æœåŠ¡å™¨å¯ä»¥æ¥å—å¹¶å¤„ç†postè¯·æ±‚ï¼Œä»¥jsonæ ¼å¼çš„æ•°æ®è¿”å›è¯·æ±‚ç»“æœåŠä¿¡æ¯ 3.3 éƒ¨åˆ†è‡ªå®šä¹‰åè®®çš„æ¥å£æ–‡æ¡£ï¼ˆå®Œæ•´ç‰ˆå¤ªå¤šäº†ï¼Œé™„äºæ–‡æ¡£æœ«å°¾ï¼‰1. è¿”å›æŠ¥æ–‡çš„bodyç»„æˆæ¯æ¬¡æœåŠ¡å™¨è¿”å›çš„æŠ¥æ–‡bodyéƒ½ä¼šåŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š 1&#123; â€œcodeâ€:code, â€œmsgâ€:â€msgâ€, â€œtypeâ€:â€typeâ€ &#125; å…¶ä¸­codeè¡¨ç¤ºè¯·æ±‚çš„ç»“æœç ï¼Œmsgè¡¨ç¤ºè¿”å›çš„å…·ä½“ä¿¡æ¯ï¼Œtypeè¡¨ç¤ºè¯·æ±‚çš„ç§ç±» 2. ç”¨æˆ·æ³¨å†Œæ¥å£è·¯å¾„ä¸º ip/register è¯·æ±‚æŠ¥æ–‡çš„bodyæ ¼å¼ï¼š 1&#123; â€œusernameâ€:â€nameâ€, â€œpwdâ€:â€passwordâ€ &#125; è¿”å›æŠ¥æ–‡çš„bodyæ ¼å¼ï¼š 1&#123; â€œcodeâ€:0, â€œmsgâ€:â€msgâ€, â€œtypeâ€:â€registerâ€ &#125; è¿”å›çš„codeåŠmsgï¼š code msg 0 æ³¨å†ŒæˆåŠŸ -1 é‡å¤çš„ç”¨æˆ·å 3. ç”¨æˆ·ç™»é™†æ¥å£è·¯å¾„ä¸ºip/login è¯·æ±‚æŠ¥æ–‡çš„bodyæ ¼å¼ï¼š 1&#123; â€œusernameâ€:â€nameâ€, â€œpwdâ€:â€passwordâ€ &#125; è¿”å›çš„bodyæ ¼å¼ï¼š 1&#123; â€œcodeâ€:0, â€œmsgâ€:â€msgâ€, â€œtypeâ€:â€loginâ€, â€œtokenâ€:12345 &#125; codeåŠmsgï¼š code msg 0 OK 1 å¯†ç é”™è¯¯ 2 å·²ç»åœ¨çº¿äº† -1 è¯¥ç”¨æˆ·å°šæœªæ³¨å†Œ 4. ç”¨æˆ·ç™»å‡ºè·¯å¾„ip/logout è¯·æ±‚æŠ¥æ–‡ï¼š 1&#123; â€œuserNameâ€:â€nameâ€, â€œtokenâ€:12345 &#125; è¿”å›æŠ¥æ–‡ï¼š 1&#123; â€œcodeâ€:0, â€œmsgâ€:â€msgâ€, â€œtypeâ€:â€ offlineâ€ &#125; codeåŠmsgï¼š code msg 0 OK 1 å·²ç»ç¦»çº¿äº† 2 tokenæ— æ•ˆ -1 ç”¨æˆ·ä¸å­˜åœ¨ 5. è·å–å¥½å‹åˆ—è¡¨è·¯å¾„ip/friends è¯·æ±‚æŠ¥æ–‡ï¼š 1&#123; â€œusernameâ€:â€nameâ€, â€œtokenâ€:12345 &#125; è¿”å›æŠ¥æ–‡ï¼š 12&#123; â€œcodeâ€:0, â€œmsgâ€:â€msgâ€, â€œtypeâ€:â€ friendsâ€, â€œfriendsâ€:[â€œfriend1â€,â€friend2â€] &#125; -- friendsæ˜¯ä¸€ä¸ªjsonArrayçš„æ•°ç»„ codeåŠmsgï¼š code msg 0 OK 1 tokenæ— æ•ˆ -1 ç”¨æˆ·å°šæœªæ³¨å†Œ 6. å®Œæ•´ç‰ˆè‡ªå®šä¹‰åè®®çš„æ¥å£æ–‡æ¡£é™„äºæœ¬æ–‡æ¡£æœ«å°¾3. å„éƒ¨åˆ†å®ç°æŠ€æœ¯ç»†èŠ‚åˆ†æ3.1 æœåŠ¡å™¨æŠ€æœ¯ç»†èŠ‚3.1.1 DataBeans åŒ… è¯¥åŒ…ä¸‹å­˜æ”¾ç™»å½•ã€æ³¨å†Œç­‰å„ç§ä¸åŒè¯·æ±‚çš„æ•°æ®ç±»ï¼Œç»Ÿä¸€å‘½åä¸ºXxxRequestBean,XxxResponseBean,å¦‚ï¼ˆCommonRequestBean, CommonResponseBeanç­‰ï¼‰ XxxRequestBeanç”¨äºå­˜å‚¨ä»è¯·æ±‚æŠ¥æ–‡ä¸­æŒ‰æ ¼å¼è§£æå‡ºçš„ä¿¡æ¯ï¼Œç”¨äºæœ¬åœ°å¯¹æ•°æ®åº“çš„æ“ä½œ XxxResponseBeanç”¨äºå­˜å‚¨æœ¬åœ°å¯¹æ•°æ®åº“å¢åˆ æŸ¥æ”¹åçš„ç»“æœï¼Œç”¨äºå‘å‘èµ·è¯·æ±‚çš„å®¢æˆ·ç«¯è¿”å›ä¿¡æ¯ä»¥åŠå‘éœ€è¦è½¬å‘çš„å®¢æˆ·ç«¯è½¬å‘æ¶ˆæ¯ å€¼å¾—ä¸€æçš„æ˜¯åœ¨è¯¥åŒ…å†…æŠ½è±¡å‡ºäº†JsonToObjectå’ŒObjectToJsonä¸¤ä¸ªæ¥å£ï¼Œå®ç°é€šä¿¡æŠ¥æ–‡ä¸­jsonæ ¼å¼æ•°æ®ä¸æœåŠ¡å™¨ä¸­javaå¯¹è±¡ç±»å‹æ•°æ®çš„é¡¹ç›®è½¬åŒ–ï¼Œæé«˜äº†ä»£ç å¤ç”¨æ€§å’Œå¯è¯»æ€§ã€‚ 3.1.2 HttpServer.java è¯¥ç±»æŒæœ‰serveræœåŠ¡å™¨çš„å¯¹è±¡ï¼Œå¹¶æŒæœ‰userMapç­‰æ•°æ®ç»“æ„ä¿å­˜ç”¨æˆ·çš„idå’Œå¯¹åº”çš„socketé€šä¿¡ï¼Œä»è€Œå®ç°æœåŠ¡å™¨å‘ç‰¹å®šç”¨æˆ·ä¸»åŠ¨æ¨é€æ¶ˆæ¯ï¼Œå®ç°å¥½å‹ç”³è¯·å’Œæ”¶åˆ°æ¶ˆæ¯çš„å³æ—¶æé†’ åœ¨æ­¤ç±»ä½¿ç”¨å¤šçº¿ç¨‹å¤„ç†æ¯ä¸ªç‹¬ç«‹çš„socketé€šä¿¡ï¼Œé¿å…ç›¸äº’ä¹‹é—´çš„å¹²æ‰°ï¼Œä¾¿äºç®¡ç†ï¼Œä¹Ÿèƒ½å®ç°å¤šç”¨æˆ·ç™»å½• æ­¤ç±»ä¸­çš„initDataBaseæ–¹æ³•ä½¿ç”¨JDBCè¿æ¥æ•°æ®åº“ï¼Œè‹¥æ˜¯æ•°æ®åº“ä¸å­˜åœ¨æ—¶åˆ™ä¸»åŠ¨å»ºç«‹æ•°æ®åº“ï¼Œå…·æœ‰è‰¯å¥½çš„å¥å£®æ€§ 3.1.3 ServerThread.java è¯¥ç±»å®šä¹‰æ¯ä¸ªç‹¬ç«‹çš„çº¿ç¨‹ä¸­socketé€šä¿¡çš„åŠ¨ä½œï¼Œå…¶ä¸­åŒ…æ‹¬ï¼š é‡è½½Threadçš„runæ–¹æ³•è§£æè‡ªå®šä¹‰çš„è¯·æ±‚æŠ¥æ–‡ï¼Œå¾—åˆ°è¯·æ±‚ç§ç±»ï¼ˆå¦‚GETï¼‰å’Œè¯·æ±‚çš„urlä»¥åŠè¯·æ±‚æŠ¥æ–‡bodyï¼Œä¼ é€’ç»™postå‡½æ•° postå‡½æ•°å¾—åˆ°æŠ¥æ–‡ï¼Œæ ¹æ®headerä¸­çš„urlå¯¹å„ä¸ªåŠŸèƒ½å‡½æ•°è¿›è¡Œè°ƒç”¨ï¼Œè¿›è¡Œç›¸åº”å¤„ç†åå¾—åˆ°åº”è¿”å›çš„æ•°æ®ã€‚å¹¶é€šè¿‡å„Beanç±»çš„æ ¼å¼åŒ–å‡½æ•°å°†ä¿¡æ¯æ ¼å¼åŒ–ä¸ºåˆæ³•çš„æŠ¥æ–‡è¿›è¡Œè¿”å› ä½¿ç”¨responseè¿”å›å‘å‡ºè¯·æ±‚çš„å®¢æˆ·ç«¯ï¼Œä½¿ç”¨sendInfoså‘è¢«è¯·æ±‚çš„å®¢æˆ·ç«¯ä¸»åŠ¨æ¨é€æ¶ˆæ¯ registï¼Œ loginç­‰åŠŸèƒ½å‡½æ•°ä»æŠ¥æ–‡çš„bodyä¸­å¾—åˆ°ç”¨æˆ·åï¼Œèº«ä»½éªŒè¯tokenç­‰ä¿¡æ¯ï¼Œç”¨äºå®ç°ç®€æ˜“å¾®ä¿¡çš„å„é¡¹åŠŸèƒ½ï¼Œå¦‚ï¼š registe ä»æŠ¥æ–‡ä¸­è·å¾—ç”¨æˆ·åå’Œå¯†ç ï¼Œåœ¨æ•°æ®åº“ä¸­è¿›è¡ŒæŸ¥è¯¢ï¼Œè¿›è¡Œæ³¨å†Œæˆ–è¿”å›å¼‚å¸¸ï¼ˆå¦‚é‡å¤ç”¨æˆ·åï¼‰ç­‰æ“ä½œ login ï¼Œlogoutæ—¶å¯¹èº«ä»½tokenè¿›è¡ŒéªŒè¯åï¼Œæ›´æ–°æ•°æ®åº“å¹¶è¿”å›ç”¨æˆ·çš„è¯·æ±‚çŠ¶æ€ï¼Œå¦‚â€œå·²ç»æ³¨å†Œâ€â€œæ³¨å†ŒæˆåŠŸâ€â€œå·²ç»åœ¨çº¿â€â€œå¯†ç é”™è¯¯â€â€œç™»å‡ºæˆåŠŸâ€ç­‰ä¿¡æ¯ getFriendsæ—¶ï¼Œæ ¹æ®ç”¨æˆ·åæŸ¥è¯¢æ•°æ®åº“ï¼Œè¿›è¡Œæ•°æ®æ›´æ–°å¹¶è¿”å›å¥½å‹åˆ—è¡¨ å‘é€æ¶ˆæ¯æ—¶ï¼Œå®¢æˆ·ç«¯è¯·æ±‚sendMsgï¼Œå‘æœåŠ¡å™¨å‘å‡ºæ¶ˆæ¯åŠæ¥æ”¶æ–¹å’Œå‘é€æ—¶é—´ï¼›æœåŠ¡å™¨æ¥åˆ°è¯¥æŠ¥æ–‡åè§£æå‡ºè¢«å‘é€æ–¹ï¼Œç„¶åé€šè¿‡sendToFriendæŸ¥è¯¢æ•°æ®åº“å¾—åˆ°è¢«å‘é€æ–¹çš„ä¿¡æ¯æ˜¯å¦åˆæ³•ï¼Œè¯¥ç”¨æˆ·æ˜¯å¦åœ¨çº¿ç­‰ï¼Œå¹¶é€šè¿‡Mapå¾—åˆ°è¯¥ç”¨æˆ·å¯¹åº”çš„socketè¿æ¥ã€‚è‹¥æ˜¯å‡ç¬¦åˆæ¡ä»¶ï¼Œè°ƒç”¨sendToå¯¹æ¶ˆæ¯è¿›è¡Œè½¬å‘ï¼Œä¸»åŠ¨å‘ç»™æ¶ˆæ¯æ¥æ”¶æ–¹ å‘é€å›¾ç‰‡å’Œæ–‡ä»¶ç±»å‹çš„æ¶ˆæ¯æµç¨‹åŸºæœ¬ä¸€è‡´ï¼Œå‡½æ•°åˆ†åˆ«ä¸ºsendPicsToFriend, sendPicså’ŒsendFileToFriends, sendFile æ·»åŠ å¥½å‹ä¸å‘é€æ¶ˆæ¯æ—¶ç±»ä¼¼ï¼Œç”¨æˆ·å°†è¯·æ±‚å‘é€ç»™æœåŠ¡å™¨ï¼Œç„¶åç”±æœåŠ¡å™¨é€šè¿‡è¢«è¯·æ±‚æ–¹å¯¹åº”çš„socketè¿æ¥è¿›è¡Œè½¬å‘ã€‚å…¶ä¸­makeFriendsè¿›è¡Œæ•°æ®åº“æŸ¥è¯¢åˆ¤æ–­ä¿¡æ¯æ˜¯å¦åˆæ³•ï¼Œå¹¶å¾—åˆ°è¢«è¯·æ±‚æ–¹å¯¹åº”çš„socketè¿æ¥ï¼Œç„¶åä½¿ç”¨sendFriendRequestç”±æœåŠ¡å™¨ä¸»åŠ¨å‘è¢«è¯·æ±‚æ–¹è½¬å‘å¥½å‹è¯·æ±‚ å‘é€å¥½å‹ç”³è¯·çš„ç»“æœæµç¨‹ä¸ç”³è¯·æ·»åŠ å¥½å‹ä¸€è‡´ï¼Œå‡½æ•°ä¸ºmakeFriendsCheckå’ŒsendResquestRes åˆ é™¤å¥½å‹deleteFriendæ—¶ï¼Œç”¨æˆ·å‘æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼ŒæœåŠ¡å™¨é€šè¿‡deleteFriendå¤„ç†æ•°æ®åº“ä¸­çš„å¥½å‹å…³ç³»è¡¨ï¼Œå®ç°å¯¹æ•°æ®çš„æ›´æ–°ï¼Œå¹¶è¿”å›ç»™ç”¨æˆ·æ“ä½œçŠ¶æ€ å‘é€å›¾ç‰‡å’Œæ–‡ä»¶æ—¶ï¼Œä½¿ç”¨Socketçš„æ–‡ä»¶è¾“å…¥è¾“å‡ºæµFileInputStreamå’ŒFileOutputStreamï¼Œè¿›è¡Œå­—èŠ‚æµä¼ è¾“ï¼Œä»¥äºŒè¿›åˆ¶æµçš„æ–¹å¼è¿›è¡Œä¼ è¾“ 3.1.4 Tuple.java é‡å†™javaçš„Tupleç±»ï¼Œä»¥å®ç°æœåŠ¡å™¨æŸäº›åŠŸèƒ½å‡½æ•°è¦æ±‚çš„å¤šè¿”å›å€¼æƒ…å†µ 3.2 å®¢æˆ·ç«¯æŠ€æœ¯ç»†èŠ‚3.2.1NetService.kt è¯¥åŒ…ä¸‹å­˜æ”¾ç™»å½•ã€æ³¨å†Œç­‰å„ç§ä¸åŒè¯·æ±‚æ–¹æ³•ï¼Œå’Œå­˜æ”¾socket è¯¥æ–‡ä»¶ä¸‹å­˜æ”¾æ‰€æœ‰ç½‘ç»œè¯·æ±‚ç›¸å…³çš„æ–¹æ³•ï¼Œå…¶ä¸­åŒ…æ‹¬ loginServiceï¼Œè¿›è¡Œç™»å½•è¯·æ±‚åŒæ—¶æ¥æ”¶æœåŠ¡å™¨çš„å›å¤ï¼Œå¦‚â€œå·²ç»æ³¨å†Œâ€â€œæ³¨å†ŒæˆåŠŸâ€â€œå·²ç»åœ¨çº¿â€â€œå¯†ç é”™è¯¯â€â€œç™»å‡ºæˆåŠŸâ€ç­‰ä¿¡æ¯ logoutServiceç™»å‡ºè¯·æ±‚åŒæ—¶æ¥æ”¶æœåŠ¡å™¨çš„å›å¤ regiServiceæ³¨å†Œè¯·æ±‚åŒæ—¶æ¥æ”¶æœåŠ¡å™¨çš„å›å¤ friendsServiceæ¥æ”¶å¥½å‹åˆ—è¡¨åŒæ—¶æ¥æ”¶æœåŠ¡å™¨çš„å›å¤ deleteServiceåˆ é™¤å¥½å‹åŒæ—¶æ¥æ”¶æœåŠ¡å™¨çš„å›å¤ makefriendsServiceæ·»åŠ å¥½å‹åŒæ—¶æ¥æ”¶æœåŠ¡å™¨çš„å›å¤ confirmRequestServiceç¡®è®¤å¥½å‹ä¿¡æ¯åŒæ—¶æ¥æ”¶æœåŠ¡å™¨çš„å›å¤ sendPictureServiceå‘é€ç…§ç‰‡åŒæ—¶æ¥æ”¶æœåŠ¡å™¨çš„å›å¤ sendMessageServiceå‘é€æ¶ˆæ¯åŒæ—¶æ¥æ”¶æœåŠ¡å™¨çš„å›ç­” 3.2.2 LoginBean.kt åœ¨è¯¥åŒ…ä¸‹ä¿å­˜ç”¨äºä¿å­˜æœåŠ¡å™¨è¯·æ±‚çš„æ•°æ®ç±» å‘½åç»Ÿä¸€ä¸ºXXBean 3.2.3Items.kt åœ¨è¯¥åŒ…ä¸‹ä¿å­˜RecyclerViewè§£è€¦ä¹‹åçš„å„ç§item ä½¿ç”¨RecyclerDSL 3.2.4UISupport.kt ç”¨äºåˆ¶ä½œæ²‰æµ¸å¼çŠ¶æ€æ  3.2.5TabFragment æä¾›äº†ç®¡ç†ä¸‰ä¸ªé¡µé¢çš„ä¸‰ä¸ªæ–¹æ³•ï¼š ç®¡ç†èŠå¤©ç•Œé¢ï¼šsetTalkList ç®¡ç†å¥½å‹ç•Œé¢ï¼šsetFriendList ç®¡ç†è®¾ç½®ï¼šsetMineList 3.2.6ItemAdapter ç”¨äºç®¡ç†èŠå¤©ç•Œé¢çš„RecyclerViewçš„æ¶ˆæ¯å±•ç¤º é€šè¿‡addItemæ–¹æ³•ç›´æ¥æ·»åŠ å­é¡¹ 3.2.7LoginActivity ç™»é™†ç•Œé¢ï¼Œç›‘å¬ä¸¤ä¸ªEditTextå’Œä¸€ä¸ªLoginButton 3.2.8MainActivity åº”ç”¨çš„æ€»ç•Œé¢ï¼Œæœ‰ä¸‰ä¸ªFragmentï¼Œåˆ†åˆ«ä¸ºæ¶ˆæ¯åˆ—è¡¨ï¼Œå¥½å‹åˆ—è¡¨å’Œä¸ªäººä¿¡æ¯ ä½¿ç”¨Handlerè¿›è¡Œå›è°ƒï¼Œè¿›è¡Œçº¿ç¨‹é—´é€šä¿¡ å¤–å±‚æ˜¯Viewpagerï¼Œå¯ä»¥è½»æ¾å®ç°é¡µé¢é—´æ»‘åŠ¨ 3.2.9TalkActivity èŠå¤©ç•Œé¢ ç‚¹ä¹å›¾å®ç°æ°”æ³¡ ä½¿ç”¨Handlerè¿›è¡Œå›è°ƒ å¯ä»¥å‘é€æ¶ˆæ¯ã€å›¾ç‰‡ã€æ–‡ä»¶ å¢åŠ æ–‡ä»¶é€‰æ‹©å™¨ï¼Œå¯ä»æœ¬åœ°é€‰æ‹©æ–‡ä»¶ 3.2.10 MVPæ¶æ„ å¯¹æ•°æ®å±‚ï¼ˆModelï¼‰ã€å¤„ç†å±‚ï¼ˆPresenterï¼‰å’Œäº¤äº’å±‚ï¼ˆViewï¼‰è¿›è¡Œè§£è€¦ ä¾¿äºç»´æŠ¤å’Œæ ¹æ®ç‰¹å®šéœ€æ±‚è¿›è¡Œä¿®æ”¹ 3.3 æ•°æ®åº“æŠ€æœ¯ç»†èŠ‚æ•°æ®åº“ä¸­é‡‡ç”¨sqlè¯­å¥å»ºç«‹ä¸¤ä¸ªè¡¨ï¼Œåˆ†åˆ«å­˜å‚¨ç”¨æˆ·ä¿¡æ¯åŠç”¨æˆ·å¥½å‹å…³ç³»ã€‚ 12345678910111213CREATE TABLE IF NOT EXISTS UserData( userName VARCHAR PRIMARY KEY, --ç”¨æˆ·åï¼Œä½œä¸ºä¸»é”® ID INTEGER, --ç”¨æˆ·id passWord VARCHAR, --å¯†ç  isOnline INTEGER, --ç”¨æˆ·åœ¨çº¿çŠ¶æ€ token INTEGER); --ç”¨äºèº«ä»½éªŒè¯çš„tokenCREATE TABLE IF NOT EXISTS UserFriends( userName VARCHAR, --ç”¨æˆ·å friendName VARCHAR, --ç”¨æˆ·çš„å¥½å‹å ID INTEGER PRIMARY KEY); --ç”¨æˆ·id -- ä¸»é”®çš„æ„ä¹‰åœ¨äºå¿«é€Ÿæ£€ç´¢æ¯ä¸ªç”¨æˆ·å¯¹åº”çš„socket å…¶ä¸­userNameå­˜å‚¨ç”¨æˆ·åï¼Œ IDä½œä¸ºä¸æ¯ä¸ªç”¨æˆ·å¯¹åº”çš„Socketé€šä¿¡çš„æ ‡è¯†ï¼ŒisOnlineå­˜å‚¨ç”¨æˆ·çš„åœ¨çº¿ç¦»çº¿çŠ¶æ€ï¼Œä¾¿äºæœåŠ¡å™¨åœ¨æ”¶åˆ°æ¶ˆæ¯å’Œå¥½å‹ç”³è¯·æ—¶çš„åˆ¤æ–­å’Œå¤„ç†ã€‚ 4. éš¾ç‚¹é‡ç‚¹å›é¡¾(ä»¥ä¸‹ä»£ç å‡ä¸ºç¤ºæ„ï¼Œå¹¶éæºä»£ç )4.1 æœåŠ¡å™¨ç«¯ æœ€æ—©æ—¶æœªä½¿ç”¨ç»Ÿä¸€çš„Serverå’Œ clientMapç®¡ç†Socketè¿æ¥ï¼Œå¯¼è‡´å„ä¸ªç”¨æˆ·çš„è¿æ¥ä¹‹é—´å‡ºç°æ•°æ®ç›¸äº’å½±å“çš„æƒ…å†µï¼Œåé€šè¿‡å¼•å…¥å¤šçº¿ç¨‹å¤„ç†æ¶ˆæ¯å’ŒMapç»Ÿä¸€ç®¡ç†æ¥è§£å†³è¿™ä¸€é—®é¢˜ 1234567public static Map&lt;Integer, Socket&gt; userMap = new HashMap&lt;&gt;();try&#123; client = this.server.accept(); new Thread(new ServerThread(client)).start();&#125; catch (IOException e) &#123; e.printStackTrace();&#125; ç”±äºTCPçŸ­è¿æ¥çš„é—®é¢˜ï¼Œå¯¼è‡´è¿æ¥ä¸ç¨³å®šï¼Œç»å¸¸æ„å¤–ä¸­æ–­ï¼Œåé€šè¿‡æŒç»­ç›‘å¬çš„å¿ƒè·³æœºåˆ¶å®ç°TCPé•¿è¿æ¥è§£å†³äº†è¯¥é—®é¢˜ 1234while(true)&#123; assert server != null; client = this.server.accept();&#125; è½¬å‘æ¶ˆæ¯æ—¶ç»å¸¸è¯¯åˆ¤éœ€è¦è¢«å‘é€çš„socketå¹¶å‡ºç°wirterrorï¼Œåæ¥é€šè¿‡å°è£…ä¸ºå‡½æ•°ï¼Œé€šè¿‡ä¼ å‚çš„æ–¹å¼ç¡®å®šsocketå’ŒæŠ¥æ–‡æ ¼å¼è§£å†³ 123456789101112131415String commonMSG = "HTTP/1.1 %code %msg\r\n" + "Content-Type: application/json;charset=utf-8\r\n" + "Connection: keep-alive\r\n" + "Content-Length: %type_body\r\n\r\n"; private void sendInfos(Socket infoClient, String json) &#123; try &#123; String res = json + "\n"; OutputStream out = client.getOutputStream(); out.write(res.getBytes()); out.flush(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125;&#125; 5. å®Œæ•´ç‰ˆæ¥å£æ–‡æ¡£1. è¿”å›æŠ¥æ–‡çš„bodyç»„æˆæ¯æ¬¡æœåŠ¡å™¨è¿”å›çš„æŠ¥æ–‡bodyéƒ½ä¼šåŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š 1&#123; â€œcodeâ€:code, â€œmsgâ€:â€msgâ€, â€œtypeâ€:â€typeâ€ &#125; å…¶ä¸­codeè¡¨ç¤ºè¯·æ±‚çš„ç»“æœç ï¼Œmsgè¡¨ç¤ºè¿”å›çš„å…·ä½“ä¿¡æ¯ï¼Œtypeè¡¨ç¤ºè¯·æ±‚çš„ç§ç±» 2. ç”¨æˆ·æ³¨å†Œæ¥å£è·¯å¾„ä¸º ip/register è¯·æ±‚æŠ¥æ–‡çš„bodyæ ¼å¼ï¼š 1&#123; â€œusernameâ€:â€nameâ€, â€œpwdâ€:â€passwordâ€ &#125; è¿”å›æŠ¥æ–‡çš„bodyæ ¼å¼ï¼š 1&#123; â€œcodeâ€:0, â€œmsgâ€:â€msgâ€, â€œtypeâ€:â€registerâ€ &#125; è¿”å›çš„codeåŠmsgï¼š code msg 0 æ³¨å†ŒæˆåŠŸ -1 é‡å¤çš„ç”¨æˆ·å 3. ç”¨æˆ·ç™»é™†æ¥å£è·¯å¾„ä¸ºip/login è¯·æ±‚æŠ¥æ–‡çš„bodyæ ¼å¼ï¼š 1&#123; â€œusernameâ€:â€nameâ€, â€œpwdâ€:â€passwordâ€ &#125; è¿”å›çš„bodyæ ¼å¼ï¼š 1&#123; â€œcodeâ€:0, â€œmsgâ€:â€msgâ€, â€œtypeâ€:â€loginâ€, â€œtokenâ€:12345 &#125; codeåŠmsgï¼š code msg 0 OK 1 å¯†ç é”™è¯¯ 2 å·²ç»åœ¨çº¿äº† -1 è¯¥ç”¨æˆ·å°šæœªæ³¨å†Œ 4. ç”¨æˆ·ç™»å‡ºè·¯å¾„ip/logout è¯·æ±‚æŠ¥æ–‡ï¼š 1&#123; â€œuserNameâ€:â€nameâ€, â€œtokenâ€:12345 &#125; è¿”å›æŠ¥æ–‡ï¼š 1&#123; â€œcodeâ€:0, â€œmsgâ€:â€msgâ€, â€œtypeâ€:â€ offlineâ€ &#125; codeåŠmsgï¼š code msg 0 OK 1 å·²ç»ç¦»çº¿äº† 2 tokenæ— æ•ˆ -1 ç”¨æˆ·ä¸å­˜åœ¨ 5. è·å–å¥½å‹åˆ—è¡¨è·¯å¾„ip/friends è¯·æ±‚æŠ¥æ–‡ï¼š 1&#123; â€œusernameâ€:â€nameâ€, â€œtokenâ€:12345 &#125; è¿”å›æŠ¥æ–‡ï¼š 12&#123; â€œcodeâ€:0, â€œmsgâ€:â€msgâ€, â€œtypeâ€:â€ friendsâ€, â€œfriendsâ€:[â€œfriend1â€,â€friend2â€] &#125; -- friendsæ˜¯ä¸€ä¸ªjsonArrayçš„æ•°ç»„ codeåŠmsgï¼š code msg 0 OK 1 tokenæ— æ•ˆ -1 ç”¨æˆ·å°šæœªæ³¨å†Œ 6. å‘é€åŠ å¥½å‹è¯·æ±‚è·¯å¾„ip/makefriends è¯·æ±‚æŠ¥æ–‡ï¼š 1&#123; â€œusernameâ€:â€nameâ€, â€œtokenâ€:12345, â€œnewfriendâ€:â€newfriendâ€ &#125; è¿”å›æŠ¥æ–‡ï¼š 1&#123; â€œcodeâ€:0, â€œmsgâ€:â€msgâ€, â€œtypeâ€:â€ makefriendâ€, &#125; codeåŠmsgï¼š code msg 0 è¯·æ±‚å‘é€æˆåŠŸ 1 token æ— æ•ˆ 2 å·²ç»æ˜¯å¥½å‹äº† 3 ç›®æ ‡ç”¨æˆ·ä¸å­˜åœ¨ -1 ç”¨æˆ·å°šæœªæ³¨å†Œ -2 ç›®æ ‡ç”¨æˆ·ä¸åœ¨çº¿ è¯·æ±‚åªæœ‰åœ¨å¯¹æ–¹åœ¨çº¿æ—¶åœ¨å…è®¸å‘é€ 7. å›å¤å¥½å‹è¯·æ±‚è·¯å¾„ip/result è¯·æ±‚æŠ¥æ–‡ï¼š 12345&#123; â€œfromâ€:â€Aâ€, â€œtoâ€:â€Bâ€, â€œtokenâ€:12345, â€œstatusâ€:1 &#125;-- from ä»£è¡¨å½“å‰ç”¨æˆ·çš„ç”¨æˆ·å-- to ä»£è¡¨æ¥å—æ–¹çš„ç”¨æˆ·å-- status ä»£è¡¨å›å¤çš„ç»“æœ-- tokenç”¨äºèº«ä»½éªŒè¯ï¼Œä¿è¯å®‰å…¨æ€§ è¿”å›æŠ¥æ–‡ï¼š 1&#123; â€œcodeâ€:0, â€œmsgâ€:â€msgâ€, â€œtypeâ€:â€ resultâ€ &#125; codeåŠmsg; code msg 0 æˆåŠŸ 1 tokenæ— æ•ˆ 2 å·²ç»æ˜¯å¥½å‹äº† 3 ç›®æ ‡ç”¨æˆ·ä¸å­˜åœ¨ -1 ç”¨æˆ·å°šæœªæ³¨å†Œ -2 ç›®æ ‡ç”¨æˆ·ä¸åœ¨çº¿ 8. æœåŠ¡å™¨ç«¯è½¬å‘å¥½å‹è¯·æ±‚æŠ¥æ–‡æ ¼å¼ï¼š 1&#123; â€œcodeâ€:0, â€œmsgâ€:â€msgâ€, â€œtypeâ€:â€ friendrequestâ€, â€œfromâ€:â€fromâ€ &#125; æœåŠ¡å™¨æ”¶åˆ°ç”¨æˆ·å‘å‡ºçš„å¥½å‹ç”³è¯·æ—¶ï¼Œä¼šä¸»åŠ¨å‘è¢«ç”³è¯·æ–¹å‘å‡ºè¯¥æ¶ˆæ¯ 9. æœåŠ¡å™¨ç«¯è½¬å‘å¥½å‹è¯·æ±‚çš„å›å¤ç»“æœæŠ¥æ–‡æ ¼å¼ï¼š 1&#123; â€œcodeâ€:0, â€œmsgâ€:â€msgâ€, â€œtypeâ€:â€ makefriendresâ€ &#125; æœåŠ¡å™¨æ”¶åˆ°è¢«ç”³è¯·æ–¹çš„å›å¤æ—¶ï¼Œä¼šä¸»åŠ¨å‘ç”³è¯·æ–¹å‘å‡ºè¯¥æ¶ˆæ¯ 10. å‘é€æ¶ˆæ¯è·¯å¾„ip/sendmsg æŠ¥æ–‡æ ¼å¼ï¼š 1&#123; â€œusernameâ€:â€nameâ€, â€œtokenâ€:12345, â€œtoâ€:â€toâ€, â€œmsgâ€:â€dataâ€ , "time":"time"&#125; è¿”å›æ ¼å¼ï¼š 1&#123; â€œcodeâ€:0, â€œmsgâ€:â€msgâ€, â€œtypeâ€:â€ sendmsgresâ€ &#125; codeåŠmsgï¼š code msg 0 å‘é€æˆåŠŸ 1 tokenæ— æ•ˆ 2 æ²¡æœ‰è¿™ä¸ªå¥½å‹ -1 è¯¥ç”¨æˆ·å°šæœªæ³¨å†Œ -2 å½“å‰ç”¨æˆ·ä¸åœ¨çº¿ 11. æœåŠ¡å™¨è½¬å‘æ¶ˆæ¯æŠ¥æ–‡æ ¼å¼ï¼š 1&#123; â€œcodeâ€:0, â€œmsgâ€:â€msgâ€, â€œtypeâ€:â€ msgâ€, â€œfromâ€:â€fromâ€ , "time":"time"&#125; å½“æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯æ—¶ï¼Œè¯¥ json ç”±æœåŠ¡å™¨ä¸»åŠ¨å‘å‡ºã€‚å…¶ä¸­ code æ€»æ˜¯ 0ï¼Œfrom è¡¨ç¤ºå‘é€æ–¹ç”¨æˆ·åï¼Œmsg ä¸ºæ¶ˆæ¯æœ¬ä½“ã€‚ 12. å‘é€æ–‡ä»¶è·¯å¾„ip/sendFile æŠ¥æ–‡æ ¼å¼ 123&#123; â€œcodeâ€:0, â€œmsgâ€:â€msgâ€, â€œtypeâ€:â€ msgâ€, â€œfromâ€:â€fromâ€ , "to": "to", "time":"time"ï¼Œ "filename": "filename"&#125; - msg å‘é€æ–‡ä»¶è½¬ç çš„å­—èŠ‚æµ- filename å‘é€æ–‡ä»¶å è¿”å›æ ¼å¼ 1&#123; â€œcodeâ€:0, â€œmsgâ€:â€msgâ€, â€œtypeâ€:â€ sendfileâ€ &#125; code msg 0 å‘é€æˆåŠŸ 1 tokenæ— æ•ˆ 2 æ²¡æœ‰è¿™ä¸ªå¥½å‹ -1 è¯¥ç”¨æˆ·å°šæœªæ³¨å†Œ -2 å½“å‰ç”¨æˆ·ä¸åœ¨çº¿ 13. æœåŠ¡å™¨ä¸»åŠ¨è½¬å‘æ–‡ä»¶å‘é€æŠ¥æ–‡ 123&#123; â€œcodeâ€:0, â€œmsgâ€:â€msgâ€, â€œtypeâ€:â€ msgâ€, â€œfromâ€:â€fromâ€ , "time":"time", "filename": "filename"&#125; - msg å‘é€æ–‡ä»¶è½¬ç çš„å­—èŠ‚æµ- filename å‘é€æ–‡ä»¶å 14. åˆ é™¤å¥½å‹è·¯å¾„ip/delete æŠ¥æ–‡æ ¼å¼ 1&#123; â€œusernameâ€:â€nameâ€, â€œtokenâ€:12345, â€œfriendnameâ€:â€friendnameâ€ &#125; è¿”å›æ ¼å¼ 1&#123; â€œcodeâ€:0, â€œmsgâ€:â€msgâ€, â€œtypeâ€:â€ deleteâ€ &#125; code msg 0 åˆ é™¤æˆåŠŸ 1 tokenæ— æ•ˆ 6. è¿è¡Œæˆªå›¾ç”±äºMarkdownæ’ç‰ˆé—®é¢˜å¯èƒ½ç•¥ä¸‘è¯·è§è°… 1.ç™»é™†åŠæ³¨å†Œç•Œé¢é»˜è®¤ æœªæ³¨å†Œ æ³¨å†Œæ—¶ç”¨æˆ·åé‡å¤ 2.é€šè®¯å½•é»˜è®¤ æ·»åŠ å¥½å‹ æ·»åŠ å¥½å‹æ—¶ç›®æ ‡å¥½å‹ç¦»çº¿ ç›®æ ‡å¥½å‹ä¸å­˜åœ¨ 3.èŠå¤©ç•Œé¢é»˜è®¤ èŠå¤©å¯¹è±¡ä¸æ˜¯å¥½å‹ 4.ä¸ªäººé¡µé¢]]></content>
      <categories>
        <category>Androidå¼€å‘</category>
      </categories>
      <tags>
        <tag>Androidå¼€å‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆå§‹å·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰]]></title>
    <url>%2Fdesirelife6.github.io%2F2019%2F09%2F02%2F%E5%88%9D%E8%AF%86%E5%8D%B7%E7%A7%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%EF%BC%88CNN%EF%BC%89%2F</url>
    <content type="text"><![CDATA[ä¸€ã€åŸºç¡€ç»“æ„CNNå’Œä¹‹ å‰ä»‹ç»çš„ç¥ç»ç½‘ç»œä¸€æ ·ï¼Œå¯ä»¥åƒä¹é«˜ç§¯æœ¨ä¸€æ ·é€šè¿‡ç»„è£…å±‚æ¥æ„å»ºã€‚ä¸è¿‡ï¼Œ CNNä¸­æ–°å‡ºç°äº†å·ç§¯å±‚ï¼ˆConvolutionå±‚ï¼‰å’Œæ± åŒ–å±‚ï¼ˆPoolingå±‚ï¼‰ã€‚æ­¤å¤–ï¼Œå„å±‚ä¸­ä¼ é€’çš„æ•°æ®æ˜¯æœ‰å½¢çŠ¶çš„æ•°æ®ï¼ˆæ¯”å¦‚ï¼Œ3ç»´æ•°æ®ï¼‰é è¿‘è¾“å‡ºçš„å±‚ä¸­ä½¿ç”¨äº†ä¹‹å‰ çš„â€œ Affine - ReLUâ€ç»„åˆã€‚æ­¤å¤–ï¼Œæœ€åçš„è¾“å‡ºå±‚ä¸­ä½¿ç”¨äº†ä¹‹å‰çš„â€œAffine - Softmaxâ€ç»„åˆã€‚è¿™äº›éƒ½æ˜¯ä¸€èˆ¬çš„CNNä¸­æ¯”è¾ƒå¸¸è§çš„ç»“æ„ã€‚ äºŒã€å·ç§¯å±‚2.1 å·ç§¯å±‚çš„ä¼˜åŠ¿åœ¨å…¨è¿æ¥å±‚ä¸­ï¼Œæ•°æ®çš„å½¢çŠ¶è¢«å¿½è§†äº†ã€‚ä»¥å›¾åƒè¾“å…¥ä¸ºä¾‹å­ï¼Œå›¾åƒé€šå¸¸æ˜¯é«˜ã€é•¿ã€é€šé“æ–¹å‘ä¸Šçš„3ç»´å½¢çŠ¶ã€‚ä½†æ˜¯ï¼Œå‘å…¨è¿æ¥å±‚è¾“å…¥æ—¶ï¼Œéœ€è¦å°†3ç»´æ•°æ®æ‹‰å¹³ä¸º1ç»´æ•°æ®ã€‚å‰é¢æåˆ°çš„ä½¿ç”¨ äº†MNISTæ•°æ®é›†çš„ä¾‹å­ä¸­ï¼Œè¾“å…¥å›¾åƒå°±æ˜¯1é€šé“ã€é«˜28åƒç´ ã€é•¿28åƒç´ çš„ï¼ˆ1, 28, 28ï¼‰å½¢çŠ¶ï¼Œä½†å´è¢«æ’æˆ1åˆ—ï¼Œä»¥784ä¸ªæ•°æ®çš„å½¢å¼è¾“å…¥åˆ°æœ€å¼€å§‹çš„ Affineå±‚ã€‚è€Œå·ç§¯å±‚å¯ä»¥ä¿æŒå½¢çŠ¶ä¸å˜ã€‚å½“è¾“å…¥æ•°æ®æ˜¯å›¾åƒæ—¶ï¼Œå·ç§¯å±‚ä¼šä»¥3ç»´æ•°æ®çš„å½¢å¼æ¥æ”¶è¾“å…¥æ•°æ®ï¼Œå¹¶åŒæ ·ä»¥3ç»´æ•°æ®çš„å½¢å¼è¾“å‡ºè‡³ä¸‹ä¸€å±‚ã€‚å› æ­¤å¯ä»¥æå–å‡ºé‚»è¿‘çš„åƒç´ ä¸ºç›¸ä¼¼çš„å€¼ã€RBGçš„å„ä¸ªé€šé“ä¹‹é—´åˆ†åˆ«æœ‰å¯†åˆ‡çš„å…³è”æ€§ã€ç›¸è· è¾ƒè¿œçš„åƒç´ ä¹‹é—´æ²¡æœ‰ä»€ä¹ˆå…³è”ç­‰å€¼å¾—æå–çš„æœ¬è´¨æ¨¡å¼ï¼Œåˆ©ç”¨ä¸æ•°æ®å½¢çŠ¶ç›¸å…³çš„ä¿¡æ¯ã€‚ 2.2 å·ç§¯è¿ç®—ï¼ˆå›¾åƒå¤„ç†ä¸­çš„æ»¤æ³¢å™¨è¿ç®—ï¼‰2.2.1 å·ç§¯è¿ç®—åŸºæœ¬è¿‡ç¨‹å…ˆæ¥çœ‹ä¸€ä¸ªç»è¿‡å·ç§¯è¿ç®—çš„ç»“æœå¯¹äºè¾“å…¥æ•°æ®ï¼Œå·ç§¯è¿ç®—ä»¥ä¸€å®šé—´éš”æ»‘åŠ¨æ»¤æ³¢å™¨çš„çª—å£å¹¶åº”ç”¨ã€‚è¿™é‡Œæ‰€è¯´çš„çª—å£æ˜¯æŒ‡ä¸‹å›¾ä¸­ç°è‰²çš„3Ã—3çš„éƒ¨åˆ†ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå°†å„ä¸ªä½ç½®ä¸Šæ»¤æ³¢å™¨çš„å…ƒç´ å’Œè¾“å…¥çš„å¯¹åº”å…ƒç´ ç›¸ä¹˜ï¼Œç„¶åå†æ±‚å’Œï¼ˆæœ‰æ—¶å°†è¿™ä¸ªè®¡ç®—ç§°ä¸ºä¹˜ç§¯ç´¯åŠ è¿ç®—ï¼‰ã€‚ç„¶åï¼Œå°†è¿™ä¸ªç»“æœä¿å­˜åˆ°è¾“å‡ºçš„å¯¹åº”ä½ç½®ã€‚å°†è¿™ä¸ªè¿‡ç¨‹åœ¨æ‰€æœ‰ä½ç½®éƒ½è¿›è¡Œä¸€éï¼Œå°±å¯ä»¥å¾—åˆ°å·ç§¯è¿ç®—çš„è¾“å‡ºã€‚ å¦‚æœæœ‰åç½®ï¼Œåˆ™åœ¨å·ç§¯è¿ç®—ç»“æœçš„å„ä¸ªä½ç½®éƒ½åŠ ä¸Šåç½®çš„å€¼ã€‚ 2.2.2 å¡«å……åœ¨å·ç§¯ç¥ç»ç½‘ç»œä¸­å¼•å…¥äº†å¡«å……å’Œæ­¥å¹…ç­‰ç‰¹æ®Šæ¦‚å¿µï¼Œè¿™é‡Œæˆ‘ä»¬æ¥ä»‹ç»ä¸€ä¸‹å¡«å……ã€‚åœ¨è¿›è¡Œå·ç§¯å±‚çš„å¤„ç†ä¹‹å‰ï¼Œæœ‰æ—¶è¦å‘è¾“å…¥æ•°æ®çš„å‘¨å›´å¡«å…¥å›ºå®šçš„æ•°æ®ï¼ˆæ¯”å¦‚0ç­‰ï¼‰ï¼Œè¿™ç§°ä¸ºå¡«å……ï¼ˆpaddingï¼‰ï¼Œæ˜¯å·ç§¯è¿ç®—ä¸­ç»å¸¸ä¼šç”¨åˆ°çš„å¤„ç†ã€‚æ¯”å¦‚ï¼Œ åœ¨ä¸‹å›¾çš„ä¾‹å­ä¸­ï¼Œå¯¹å¤§å°ä¸º(4, 4)çš„è¾“å…¥æ•°æ®åº”ç”¨äº†å¹…åº¦ä¸º1çš„å¡«å……ã€‚â€œå¹…åº¦ä¸º1çš„å¡«å……â€æ˜¯æŒ‡ç”¨å¹…åº¦ä¸º1åƒç´ çš„0å¡«å……å‘¨å›´ã€‚å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡å¡«å……ï¼Œå¤§å°ä¸º(4, 4)çš„è¾“å…¥æ•°æ®å˜æˆäº†(6,6)çš„å½¢çŠ¶ã€‚ ç„¶åï¼Œåº”ç”¨å¤§å°ä¸º(3, 3)çš„æ»¤æ³¢å™¨ï¼Œç”Ÿæˆäº†å¤§å°ä¸º(4,4)çš„è¾“å‡ºæ•°æ®ã€‚è¿™ä¸ªä¾‹å­ä¸­å°†å¡«å……çš„å€¼è®¾æˆäº†1ï¼Œä¸è¿‡å¡«å……çš„å€¼ä¹Ÿå¯ä»¥è®¾ç½®æˆ2ã€3ç­‰ä»»æ„çš„æ•´æ•°ã€‚åœ¨å›¾è¯¥ä¾‹å­ä¸­ï¼Œå¦‚æœå°†å¡«å……è®¾ä¸º2ï¼Œåˆ™è¾“å…¥æ•°æ®çš„å¤§å°å˜ä¸º(8,8)ï¼›å¦‚æœå°†å¡«å……è®¾ ä¸º3ï¼Œåˆ™å¤§å°å˜ä¸º(10, 10)ã€‚ ä½¿ç”¨å¡«å……ä¸»è¦æ˜¯ä¸ºäº†è°ƒæ•´è¾“å‡ºçš„å¤§å°ã€‚æ¯”å¦‚ï¼Œå¯¹å¤§å°ä¸º(4, 4)çš„è¾“å…¥æ•°æ®åº”ç”¨(3,3)çš„æ»¤æ³¢å™¨æ—¶ï¼Œè¾“å‡ºå¤§å°å˜ä¸º(2, 2)ï¼Œç›¸å½“äºè¾“å‡ºå¤§å°æ¯”è¾“å…¥å¤§å°ç¼©å°äº†2ä¸ªå…ƒç´ ã€‚åœ¨åå¤è¿›è¡Œå¤šæ¬¡å·ç§¯è¿ç®—çš„æ·±åº¦ç½‘ç»œä¸­,å¦‚æœæ¯æ¬¡è¿›è¡Œå·ç§¯è¿ç®—éƒ½ä¼šç¼©å°ç©ºé—´ï¼Œé‚£ä¹ˆåœ¨æŸä¸ªæ—¶åˆ»è¾“å‡ºå¤§å°å°±æœ‰å¯èƒ½å˜ä¸º1ï¼Œå¯¼è‡´æ— æ³•å†åº”ç”¨å·ç§¯è¿ç®—ã€‚ 2.2.3 æ­¥å¹…ä»‹ç»å®Œå¡«å……ï¼Œå†æ¥ä»‹ç»ä¸€ä¸‹æ­¥å¹…ã€‚æ­¥å¹…æ˜¯åº”ç”¨æ»¤æ³¢å™¨çš„ä½ç½®é—´éš”ï¼Œä»¥ä¸‹æ˜¯æ­¥å¹…ä¸º2çš„æƒ…å†µã€‚ 2.2.4 å¡«å……ï¼Œæ­¥å¹…å’Œè¾“å‡ºç»“æœçš„ç“œç³»å¢å¤§æ­¥å¹…åï¼Œè¾“å‡ºå¤§å°ä¼šå˜å°ã€‚è€Œå¢å¤§å¡«å……åï¼Œè¾“å‡ºå¤§å°ä¼šå˜å¤§ã€‚ å¦‚æœå°†è¿™æ ·çš„å…³ç³»å†™æˆç®—å¼ï¼Œä¼šå¦‚ä½•å‘¢ï¼Ÿæˆ‘ä»¬çœ‹ä¸€ä¸‹å¯¹äºå¡«å……å’Œæ­¥å¹…ï¼Œå¦‚ä½•è®¡ç®—è¾“å‡ºå¤§å°ã€‚ è¿™é‡Œï¼Œå‡è®¾è¾“å…¥å¤§å°ä¸º(H,W)ï¼Œæ»¤æ³¢å™¨å¤§å°ä¸º(FH,FW)ï¼Œè¾“å‡ºå¤§å°ä¸º (OH,OW)ï¼Œå¡«å……ä¸ºPï¼Œæ­¥å¹…ä¸ºSã€‚æ­¤æ—¶ï¼Œè¾“å‡ºå¤§å°å¯é€šè¿‡ä¸‹åˆ—å¼å­è®¡ç®—ã€‚ $$ OH = \frac{H+2P-FH}{S} + 1 $$ $$ OW = \frac{H+2P-FW}{S} + 1 $$ æˆ‘ä»¬æ¥æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆå·ç§¯è¿ç®—æ˜¯æœ‰æ•ˆçš„ï¼Ÿä¾ç„¶ç”¨ä¾‹å­æ¥è¯´æ˜ï¼Œæ¯”å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ª4*4çš„å›¾åƒï¼Œæˆ‘ä»¬è®¾è®¡ä¸¤ä¸ªå·ç§¯æ ¸ï¼Œçœ‹çœ‹è¿ç”¨å·ç§¯æ ¸åå›¾ç‰‡ä¼šå˜æˆä»€ä¹ˆæ ·ã€‚ä»ç»“æœå¯ä»¥çœ‹å‡ºï¼Œé€šè¿‡ç¬¬ä¸€ä¸ªå·ç§¯æ ¸è®¡ç®—åçš„ç‰¹å¾å›¾æ˜¯ä¸€ä¸ªä¸‰ç»´æ•°æ®ï¼Œåœ¨ç¬¬ä¸‰åˆ—çš„ç»å¯¹å€¼æœ€å¤§ï¼Œè¯´æ˜åŸå§‹å›¾ç‰‡ä¸Šå¯¹åº”çš„åœ°æ–¹æœ‰ä¸€æ¡å‚ç›´æ–¹å‘çš„ç‰¹å¾ï¼Œå³åƒç´ æ•°å€¼å˜åŒ–è¾ƒå¤§ï¼›è€Œé€šè¿‡ç¬¬äºŒä¸ªå·ç§¯æ ¸è®¡ç®—åï¼Œç¬¬ä¸‰åˆ—çš„æ•°å€¼ä¸º0ï¼Œç¬¬äºŒè¡Œçš„æ•°å€¼ç»å¯¹å€¼æœ€å¤§ï¼Œè¯´æ˜åŸå§‹å›¾ç‰‡ä¸Šå¯¹åº”çš„åœ°æ–¹æœ‰ä¸€æ¡æ°´å¹³æ–¹å‘çš„ç‰¹å¾ï¼Œå³åƒç´ å€¼æ•°å€¼å˜åŒ–è¾ƒå¤§ã€‚è¿™æ ·å°±æå–å‡ºäº†å¤§è‡´çš„ä¸¤ä¸ªç‰¹å¾ï¼Œé€šè¿‡åœ¨æ›´æ·±å±‚æ¬¡çš„ç½‘ç»œä¸­è®¾ç½®æ›´å¤šæ›´å·§å¦™çš„å·ç§¯æ ¸ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°æ›´å¤šæ›´å‡†ç¡®çš„ç‰¹å¾ã€‚æˆ‘ä»¬è®¾è®¡çš„å·ç§¯æ ¸åˆ†åˆ«èƒ½å¤Ÿæå–ï¼Œæˆ–è€…è¯´æ£€æµ‹å‡ºåŸå§‹å›¾ç‰‡çš„ç‰¹å®šçš„ç‰¹å¾ã€‚æ‰€ä»¥å®é™…ä¸Šå°±å¯ä»¥æŠŠå·ç§¯æ ¸ç†è§£ä¸ºç‰¹å¾æå–å™¨ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ‰‹åŠ¨å»é€‰å–ç‰¹å¾ï¼Œåªç”¨è®¾è®¡å¥½å·ç§¯æ ¸çš„å°ºå¯¸ï¼Œæ•°é‡å’Œæ»‘åŠ¨çš„æ­¥é•¿å°±å¯ä»¥è®©å®ƒè‡ªå·±å»è®­ç»ƒäº†ã€‚åŒæ—¶ï¼Œç”±äºå¤šä¸ªç¥ç»å…ƒå¯ä»¥å…±äº«å·ç§¯æ ¸ï¼Œå¯¹äºé«˜ä½æ•°æ®çš„å¤„ç†å°†ä¼šå˜å¾—éå¸¸ç®€å•ã€‚ç•™ä¸‹å‡ ä¸ªå°é—®é¢˜ä¾›å¤§å®¶æ€è€ƒï¼š 1.å·ç§¯æ ¸çš„å°ºå¯¸å¿…é¡»ä¸ºæ­£æ–¹å½¢å—ï¼Ÿå¯ä»¥ä¸ºé•¿æ–¹å½¢å—ï¼Ÿå¦‚æœæ˜¯é•¿æ–¹å½¢åº”è¯¥æ€ä¹ˆè®¡ç®—ï¼Ÿ 2.å·ç§¯æ ¸çš„ä¸ªæ•°å¦‚ä½•ç¡®å®šï¼Ÿæ¯ä¸€å±‚çš„å·ç§¯æ ¸çš„ä¸ªæ•°éƒ½æ˜¯ç›¸åŒçš„å—ï¼Ÿ 3.æ­¥é•¿çš„å‘å³å’Œå‘ä¸‹ç§»åŠ¨çš„å¹…åº¦å¿…é¡»æ˜¯ä¸€æ ·çš„å—ï¼Ÿ åœ¨æœ€åæˆ‘å°†ç»™å‡ºè¿™äº›é—®é¢˜çš„ç­”æ¡ˆã€‚ 2.2.5 å¤šé€šé“å›¾çš„å·ç§¯è¿ç®—è¿™é‡Œå…ˆä»‹ç»å•é€šé“å›¾å’Œå¤šé€šé“å›¾çš„æ¦‚å¿µï¼ˆä¸€ï¼‰ï¼šå•é€šé“å›¾ä¿—ç§°ç°åº¦å›¾ï¼Œæ¯ä¸ªåƒç´ ç‚¹åªèƒ½æœ‰æœ‰ä¸€ä¸ªå€¼è¡¨ç¤ºé¢œè‰²ï¼Œå®ƒçš„åƒç´ å€¼åœ¨0åˆ°255ä¹‹é—´ï¼Œ0æ˜¯é»‘è‰²ï¼Œ255æ˜¯ç™½è‰²ï¼Œä¸­é—´å€¼æ˜¯ä¸€äº›ä¸åŒç­‰çº§çš„ç°è‰²ã€‚ï¼ˆä¹Ÿæœ‰3é€šé“çš„ç°åº¦å›¾ï¼Œ3é€šé“ç°åº¦å›¾åªæœ‰ä¸€ä¸ªé€šé“æœ‰å€¼ï¼Œå…¶ä»–ä¸¤ä¸ªé€šé“çš„å€¼éƒ½æ˜¯é›¶ï¼‰ã€‚ï¼ˆäºŒï¼‰:ä¸‰é€šé“å›¾æ¯ä¸ªåƒç´ ç‚¹éƒ½æœ‰3ä¸ªå€¼è¡¨ç¤º ï¼Œæ‰€ä»¥å°±æ˜¯3é€šé“ã€‚ä¹Ÿæœ‰4é€šé“çš„å›¾ã€‚ä¾‹å¦‚RGBå›¾ç‰‡å³ä¸ºä¸‰é€šé“å›¾ç‰‡ï¼ŒRGBè‰²å½©æ¨¡å¼æ˜¯å·¥ä¸šç•Œçš„ä¸€ç§é¢œè‰²æ ‡å‡†ï¼Œæ˜¯é€šè¿‡å¯¹çº¢(R)ã€ç»¿(G)ã€è“(B)ä¸‰ä¸ªé¢œè‰²é€šé“çš„å˜åŒ–ä»¥åŠå®ƒä»¬ç›¸äº’ä¹‹é—´çš„å åŠ æ¥å¾—åˆ°å„å¼å„æ ·çš„é¢œè‰²çš„ï¼ŒRGBå³æ˜¯ä»£è¡¨çº¢ã€ç»¿ã€è“ä¸‰ä¸ªé€šé“çš„é¢œè‰²ï¼Œè¿™ä¸ªæ ‡å‡†å‡ ä¹åŒ…æ‹¬äº†äººç±»è§†åŠ›æ‰€èƒ½æ„ŸçŸ¥çš„æ‰€æœ‰é¢œè‰²ï¼Œæ˜¯ç›®å‰è¿ç”¨æœ€å¹¿çš„é¢œè‰²ç³»ç»Ÿä¹‹ä¸€ã€‚æ€»ä¹‹ï¼Œæ¯ä¸€ä¸ªç‚¹ç”±ä¸‰ä¸ªå€¼è¡¨ç¤ºã€‚ ä¹‹å‰çš„å·ç§¯è¿ç®—çš„ä¾‹å­éƒ½æ˜¯ä»¥æœ‰é«˜ã€é•¿æ–¹å‘çš„2ç»´å½¢çŠ¶çš„å•é€šé“å›¾ä¸ºå¯¹è±¡çš„ã€‚ä½†æ˜¯ï¼Œ å›¾åƒæ˜¯3ç»´æ•°æ®ï¼Œé™¤äº†é«˜ã€é•¿æ–¹å‘ä¹‹å¤–ï¼Œè¿˜éœ€è¦å¤„ç†é€šé“æ–¹å‘ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬æŒ‰ç…§ä¸ä¹‹å‰ç›¸åŒçš„é¡ºåºï¼Œçœ‹ä¸€ä¸‹å¯¹åŠ ä¸Šäº†é€šé“æ–¹å‘çš„3ç»´æ•°æ®è¿›è¡Œå·ç§¯è¿ç®—çš„ä¾‹å­ã€‚è¿™é‡Œä»¥3é€šé“çš„æ•°æ®ä¸ºä¾‹ï¼Œ å±•ç¤ºäº†å·ç§¯è¿ç®—çš„ç»“æœã€‚å’Œ2ç»´æ•°æ®æ—¶ç›¸æ¯”ï¼Œå¯ä»¥å‘ç°çºµæ·±æ–¹å‘ï¼ˆé€šé“æ–¹å‘ï¼‰ä¸Šç‰¹å¾å›¾å¢åŠ äº†ã€‚é€šé“æ–¹å‘ä¸Šæœ‰å¤šä¸ªç‰¹å¾å›¾æ—¶ï¼Œä¼šæŒ‰é€šé“è¿›è¡Œè¾“å…¥æ•°æ®å’Œæ»¤æ³¢å™¨çš„å·ç§¯è¿ç®—ï¼Œå¹¶å°†ç»“æœç›¸åŠ ï¼Œä»è€Œå¾—åˆ°è¾“å‡ºã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨3ç»´æ•°æ®çš„å·ç§¯è¿ç®—ä¸­ï¼Œè¾“å…¥æ•°æ®å’Œæ»¤æ³¢å™¨çš„é€šé“æ•°è¦è®¾ä¸ºç›¸åŒçš„å€¼ã€‚ä»ä¸Šå›¾å¯çŸ¥ï¼Œæ¯ä¸ªå·ç§¯æ ¸è¾“å‡ºä¸€å¼ ç‰¹å¾å›¾ï¼Œè€Œå¤šä¸ªå·ç§¯æ ¸è¾“å‡ºçš„ç‰¹å¾å›¾æ±‡é›†åœ¨ä¸€èµ·ï¼Œä¼ é€’ç»™ä¸‹ä¸€å±‚ï¼Œè¿™å°±æ˜¯CNNçš„å¤„ç†æµã€‚æœ€åå†çœ‹çœ‹ä¸€çœ‹å·ç§¯è¿ç®—ä¸­çš„å¤„ç†æµæ˜¯ä»€ä¹ˆäºšå­ã€‚ ä¸‰ã€ æ± åŒ–è®²äº†è¿™ä¹ˆä¹…çš„å·ç§¯ï¼Œç»ˆäºæ¥åˆ°äº†æ± åŒ–ï¼ˆpoolingï¼‰å±‚æ± åŒ–æ˜¯ç¼©å°é«˜ã€é•¿æ–¹å‘ä¸Šçš„ç©ºé—´çš„è¿ç®—ã€‚æ¯”å¦‚ï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œè¿›è¡Œå°† 2Ã—2çš„åŒºåŸŸé›†çº¦æˆ1ä¸ªå…ƒç´ çš„å¤„ç†ï¼Œç¼©å°ç©ºé—´å¤§å°ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæ± åŒ–çš„çª—å£å¤§å°ä¼š å’Œæ­¥å¹…è®¾å®šæˆç›¸åŒçš„å€¼ã€‚ é™¤äº†MaxPoolingä¹‹å¤–ï¼Œè¿˜æœ‰AveragePoolingç­‰ã€‚ç›¸å¯¹äºMaxPoolingæ˜¯ä»ç›®æ ‡åŒºåŸŸä¸­å–å‡ºæœ€å¤§å€¼ï¼ŒAveragePoolingåˆ™æ˜¯è®¡ç®—ç›®æ ‡åŒºåŸŸçš„å¹³å‡å€¼ã€‚ åœ¨å›¾åƒè¯†åˆ«é¢†åŸŸï¼Œä¸»è¦ä½¿ç”¨MaxPoolingã€‚ é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä¸ºä»€ä¹ˆMaxPoolingèƒ½èµ·åˆ°æ•ˆæœå‘¢MaxPoolingæ„ä¹‰åœ¨å“ªé‡Œï¼Ÿå¦‚æœæˆ‘ä»¬åªå–æœ€å¤§å€¼ï¼Œé‚£å…¶ä»–çš„å€¼è¢«èˆå¼ƒéš¾é“å°±æ²¡æœ‰å½±å“å—ï¼Ÿä¸ä¼šæŸå¤±è¿™éƒ¨åˆ†ä¿¡æ¯å—ï¼Ÿå¦‚æœè®¤ä¸ºè¿™äº›ä¿¡æ¯æ˜¯å¯æŸå¤±çš„ï¼Œé‚£ä¹ˆæ˜¯å¦æ„å‘³ç€æˆ‘ä»¬åœ¨è¿›è¡Œå·ç§¯æ“ä½œåä»ç„¶äº§ç”Ÿäº†ä¸€äº›ä¸å¿…è¦çš„å†—ä½™ä¿¡æ¯å‘¢ï¼Ÿ å…¶å®ä»ä¸Šæ–‡åˆ†æå·ç§¯æ ¸ä¸ºä»€ä¹ˆæœ‰æ•ˆçš„åŸå› æ¥çœ‹ï¼Œæ¯ä¸€ä¸ªå·ç§¯æ ¸å¯ä»¥çœ‹åšä¸€ä¸ªç‰¹å¾æå–å™¨ï¼Œä¸åŒçš„å·ç§¯æ ¸è´Ÿè´£æå–ä¸åŒçš„ç‰¹å¾ï¼Œæˆ‘ä»¬ä¾‹å­ä¸­è®¾è®¡çš„ç¬¬ä¸€ä¸ªå·ç§¯æ ¸èƒ½å¤Ÿæå–å‡ºâ€œå‚ç›´â€æ–¹å‘çš„ç‰¹å¾ï¼Œç¬¬äºŒä¸ªå·ç§¯æ ¸èƒ½å¤Ÿæå–å‡ºâ€œæ°´å¹³â€æ–¹å‘çš„ç‰¹å¾ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯¹å…¶è¿›è¡ŒMaxPoolingæ“ä½œåï¼Œæå–å‡ºçš„æ˜¯çœŸæ­£èƒ½å¤Ÿè¯†åˆ«ç‰¹å¾çš„æ•°å€¼ï¼Œå…¶ä½™è¢«èˆå¼ƒçš„æ•°å€¼ï¼Œå¯¹äºæˆ‘æå–ç‰¹å®šçš„ç‰¹å¾å¹¶æ²¡æœ‰ç‰¹åˆ«å¤§çš„å¸®åŠ©ã€‚åœ¨è¿›è¡Œåç»­è®¡ç®—æ—¶ï¼Œå°±å‡å°äº†ç‰¹å¾å›¾çš„å°ºå¯¸ï¼Œä»è€Œå‡å°‘å‚æ•°ï¼Œè¾¾åˆ°å‡å°è®¡ç®—é‡ï¼Œç¼ºä¸æŸå¤±æ•ˆæœçš„æƒ…å†µã€‚ è¿™ä¹Ÿæ„å‘³ç€MaxPoolingå¯¹å¾®å°çš„ä½ç½®å˜åŒ–å…·æœ‰å¥å£®æ€§ï¼Œè¾“å…¥æ•°æ®å‘ç”Ÿå¾®å°åå·®æ—¶ï¼Œæ± åŒ–ä»ä¼šè¿”å›ç›¸åŒçš„ç»“æœ,æ± åŒ–ä¼šå¸æ”¶è¾“å…¥æ•°æ®çš„åå·®ï¼ˆæ ¹æ®æ•°æ®çš„ä¸åŒï¼Œç»“æœæœ‰å¯èƒ½ä¸ä¸€è‡´ï¼‰ã€‚ ä¸è¿‡å¹¶ä¸æ˜¯æ‰€æœ‰æƒ…å†µMaxPoolingçš„æ•ˆæœéƒ½å¾ˆå¥½ï¼Œæœ‰æ—¶å€™æœ‰äº›å‘¨è¾¹ä¿¡æ¯ä¹Ÿä¼šå¯¹æŸä¸ªç‰¹å®šç‰¹å¾çš„è¯†åˆ«äº§ç”Ÿä¸€å®šæ•ˆæœï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™èˆå¼ƒè¿™éƒ¨åˆ†â€œä¸é‡è¦â€çš„ä¿¡æ¯ï¼Œå°±ä¸åˆ’ç®—äº†ã€‚æ‰€ä»¥è¿˜è¦å…·ä½“æƒ…å†µå…·ä½“åˆ†æï¼Œå¦‚æœåŠ äº†Max Poolingåæ•ˆæœåè€Œå˜å·®äº†ï¼Œä¸å¦‚æŠŠå·ç§¯åä¸åŠ MaxPoolingçš„ç»“æœä¸å·ç§¯ååŠ äº†MaxPoolingçš„ç»“æœè¾“å‡ºå¯¹æ¯”ä¸€ä¸‹ï¼Œçœ‹çœ‹MaxPoolingæ˜¯å¦å¯¹å·ç§¯æ ¸æå–ç‰¹å¾èµ·äº†åæ•ˆæœã€‚ 3.1 Flattenå±‚ &amp; Fully Connected Layer åˆ°è¿™ä¸€æ­¥ï¼Œå…¶å®æˆ‘ä»¬çš„ä¸€ä¸ªå®Œæ•´çš„â€œå·ç§¯éƒ¨åˆ†â€å°±ç®—å®Œæˆäº†ï¼Œå¦‚æœæƒ³è¦å åŠ å±‚æ•°ï¼Œä¸€èˆ¬ä¹Ÿæ˜¯å åŠ â€œConv-MaxPooingâ€,é€šè¿‡ä¸æ–­çš„è®¾è®¡å·ç§¯æ ¸çš„å°ºå¯¸ï¼Œæ•°é‡ï¼Œæå–æ›´å¤šçš„ç‰¹å¾ï¼Œæœ€åè¯†åˆ«ä¸åŒç±»åˆ«çš„ç‰©ä½“ã€‚åšå®ŒMaxPoolingåï¼Œæˆ‘ä»¬å°±ä¼šæŠŠè¿™äº›æ•°æ®â€œæ‹å¹³â€ï¼Œä¸¢åˆ°Flattenå±‚ï¼Œç„¶åæŠŠFlattenå±‚çš„outputæ”¾åˆ°full connected Layeré‡Œï¼Œé‡‡ç”¨softmaxå¯¹å…¶è¿›è¡Œåˆ†ç±»ã€‚ å››ã€ CNNçš„å¯è§†åŒ–å­¦ä¹ å‰çš„æ»¤æ³¢å™¨æ˜¯éšæœºè¿›è¡Œåˆå§‹åŒ–çš„ï¼Œæ‰€ä»¥åœ¨é»‘ç™½çš„æµ“æ·¡ä¸Šæ²¡æœ‰è§„å¾‹å¯å¾ªï¼Œä½†å­¦ä¹ åçš„æ»¤æ³¢å™¨å˜æˆäº†æœ‰è§„å¾‹çš„å›¾åƒã€‚æˆ‘ä»¬å‘ç°ï¼Œé€šè¿‡å­¦ä¹ ï¼Œæ»¤æ³¢å™¨è¢«æ›´æ–°æˆäº†æœ‰è§„å¾‹çš„æ»¤æ³¢å™¨ï¼Œæ¯”å¦‚ä»ç™½åˆ°é»‘æ¸å˜çš„æ»¤æ³¢å™¨ã€å«æœ‰å—çŠ¶åŒºåŸŸï¼ˆç§°ä¸ºblobï¼‰çš„æ»¤æ³¢å™¨ç­‰ã€‚å¦‚æœè¦é—®å³è¾¹çš„æœ‰è§„å¾‹çš„æ»¤æ³¢å™¨åœ¨â€œè§‚å¯Ÿâ€ä»€ä¹ˆï¼Œç­”æ¡ˆå°±æ˜¯å®ƒåœ¨è§‚å¯Ÿè¾¹ç¼˜ï¼ˆé¢œè‰²å˜åŒ–çš„åˆ†ç•Œçº¿ï¼‰å’Œæ–‘å—ï¼ˆå±€éƒ¨çš„å—çŠ¶åŒºåŸŸï¼‰ç­‰ã€‚æ¯”å¦‚ï¼Œå·¦åŠéƒ¨åˆ†ä¸ºç™½è‰²ã€å³åŠéƒ¨åˆ†ä¸ºé»‘è‰²çš„æ»¤æ³¢å™¨çš„æƒ…å†µä¸‹ï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œä¼šå¯¹å‚ç›´æ–¹å‘ä¸Šçš„è¾¹ç¼˜æœ‰å“åº”ã€‚ äº”ã€é—®é¢˜å°ç»“æœ€åæ˜¯ä¸Šé¢ç»™å¤§å®¶ç•™ä¸‹çš„é—®é¢˜1.å·ç§¯æ ¸çš„å°ºå¯¸å¿…é¡»ä¸ºæ­£æ–¹å½¢å—ï¼Ÿå¯ä»¥ä¸ºé•¿æ–¹å½¢å—ï¼Ÿå¦‚æœæ˜¯é•¿æ–¹å½¢åº”è¯¥æ€ä¹ˆè®¡ç®—ï¼Ÿ 2.å·ç§¯æ ¸çš„ä¸ªæ•°å¦‚ä½•ç¡®å®šï¼Ÿæ¯ä¸€å±‚çš„å·ç§¯æ ¸çš„ä¸ªæ•°éƒ½æ˜¯ç›¸åŒçš„å—ï¼Ÿ 3.æ­¥é•¿çš„å‘å³å’Œå‘ä¸‹ç§»åŠ¨çš„å¹…åº¦å¿…é¡»æ˜¯ä¸€æ ·çš„å—ï¼Ÿ ä¸‹é¢çš„æƒ³æ³•ï¼Œå¯ä»¥ä½œä¸ºå‚è€ƒï¼š 1.å·ç§¯æ ¸çš„å°ºå¯¸ä¸ä¸€å®šéå¾—ä¸ºæ­£æ–¹å½¢ã€‚é•¿æ–¹å½¢ä¹Ÿå¯ä»¥ï¼Œåªä¸è¿‡é€šå¸¸æƒ…å†µä¸‹ä¸ºæ­£æ–¹å½¢ã€‚å¦‚æœè¦è®¾ç½®ä¸ºé•¿æ–¹å½¢ï¼Œé‚£ä¹ˆé¦–å…ˆå¾—ä¿è¯è¿™å±‚çš„è¾“å‡ºå½¢çŠ¶æ˜¯æ•´æ•°ï¼Œä¸èƒ½æ˜¯å°æ•°ï¼ˆä¸€äº›æ¡†æ¶ä¼šå¯¹å°æ•°è¿›è¡Œå››èˆäº”å…¥å¤„ç†ï¼Œä¸€äº›ä¼šå¼•èµ·æŠ¥é”™ï¼‰ã€‚å¦‚æœä½ çš„å›¾åƒæ˜¯è¾¹é•¿ä¸º 28 çš„æ­£æ–¹å½¢ã€‚é‚£ä¹ˆå·ç§¯å±‚çš„è¾“å‡ºå°±æ»¡è¶³ [ (28 - kernel_size)/ stride ] + 1 ï¼Œè¿™ä¸ªæ•°å€¼å¾—æ˜¯æ•´æ•°æ‰è¡Œï¼Œå¦åˆ™æ²¡æœ‰ç‰©ç†æ„ä¹‰ã€‚æ± åŒ–å±‚åŒç†ã€‚FC å±‚çš„è¾“å‡ºå½¢çŠ¶æ€»æ˜¯æ»¡è¶³æ•´æ•°ï¼Œå…¶å”¯ä¸€çš„è¦æ±‚å°±æ˜¯æ•´ä¸ªè®­ç»ƒè¿‡ç¨‹ä¸­ FC å±‚çš„è¾“å…¥å¾—æ˜¯å®šé•¿çš„ã€‚å¦‚æœä½ çš„å›¾åƒä¸æ˜¯æ­£æ–¹å½¢ã€‚é‚£ä¹ˆåœ¨åˆ¶ä½œæ•°æ®æ—¶ï¼Œå¯ä»¥ç¼©æ”¾åˆ°ç»Ÿä¸€å¤§å°ï¼ˆéæ­£æ–¹å½¢ï¼‰ï¼Œå†ä½¿ç”¨éæ­£æ–¹å½¢çš„å·ç§¯æ ¸æ¥ä½¿å¾—å·ç§¯å±‚çš„è¾“å‡ºä¾ç„¶æ˜¯æ•´æ•°ã€‚æ€»ä¹‹ï¼Œæ’‡å¼€ç½‘ç»œç»“æœè®¾å®šçš„å¥½åä¸è°ˆï¼Œå…¶æœ¬è´¨ä¸Šå°±æ˜¯åœ¨åšç®—æœ¯åº”ç”¨é¢˜ï¼šå¦‚ä½•ä½¿å¾—å„å±‚çš„è¾“å‡ºæ˜¯æ•´æ•°ã€‚ 2.ç”±ç»éªŒç¡®å®šã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œé è¿‘è¾“å…¥çš„å·ç§¯å±‚ï¼Œè­¬å¦‚ç¬¬ä¸€å±‚å·ç§¯å±‚ï¼Œä¼šæ‰¾å‡ºä¸€äº›å…±æ€§çš„ç‰¹å¾ï¼Œå¦‚æ‰‹å†™æ•°å­—è¯†åˆ«ä¸­ç¬¬ä¸€å±‚æˆ‘ä»¬è®¾å®šå·ç§¯æ ¸ä¸ªæ•°ä¸º5ä¸ªï¼Œä¸€èˆ¬æ˜¯æ‰¾å‡ºè¯¸å¦‚â€æ¨ªçº¿â€ã€â€œç«–çº¿â€ã€â€œæ–œçº¿â€ç­‰å…±æ€§ç‰¹å¾ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºbasic featureï¼Œç»è¿‡æ± åŒ–åï¼Œåœ¨ç¬¬äºŒå±‚å·ç§¯å±‚ï¼Œè®¾å®šå·ç§¯æ ¸ä¸ªæ•°ä¸º20ä¸ªï¼Œå¯ä»¥æ‰¾å‡ºä¸€äº›ç›¸å¯¹å¤æ‚çš„ç‰¹å¾ï¼Œå¦‚â€œæ¨ªæŠ˜â€ã€â€œå·¦åŠåœ†â€ã€â€œå³åŠåœ†â€ç­‰ç‰¹å¾ï¼Œè¶Šå¾€åï¼Œå·ç§¯æ ¸è®¾å®šçš„æ•°ç›®è¶Šå¤šï¼Œè¶Šèƒ½ä½“ç°çš„ç‰¹å¾å°±è¶Šç»†è‡´ï¼Œå°±è¶Šå®¹æ˜“åˆ†ç±»å‡ºæ¥ã€‚æ¯”å¦‚ä½ æƒ³åˆ†ç±»å‡ºâ€œ0â€çš„æ•°å­—ï¼Œä½ çœ‹åˆ°è¿™ä¸ªç‰¹å¾ï¼Œèƒ½æ¨æµ‹æ˜¯ä»€ä¹ˆæ•°å­—å‘¢ï¼Ÿåªæœ‰è¶Šå¾€åï¼Œæ£€æµ‹è¯†åˆ«çš„ç‰¹å¾è¶Šå¤šï¼Œè¯•è¿‡æ‰èƒ½æ…¢æ…¢èƒ½è¯†åˆ«å‡ºè¿™å‡ ä¸ªç‰¹å¾ï¼Œé‚£ä¹ˆæˆ‘å°±èƒ½å¤Ÿç¡®å®šè¿™ä¸ªæ•°å­—æ˜¯â€œ0â€ã€‚ 3.æœ‰stride_wå’Œstride_hï¼Œè¡¨ç¤ºå·¦å³æ­¥é•¿å’Œä¸Šä¸‹æ­¥é•¿ã€‚å¦‚æœç”¨strideï¼Œåˆ™è¡¨ç¤ºstride_h=stride_w=strideã€‚]]></content>
      <categories>
        <category>äººå·¥æ™ºèƒ½</category>
      </categories>
      <tags>
        <tag>ç¥ç»ç½‘ç»œ</tag>
        <tag>æœºå™¨å­¦ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç¥ç»ç½‘ç»œçš„åå‘è¯¯å·®ä¼ æ’­]]></title>
    <url>%2Fdesirelife6.github.io%2F2019%2F08%2F30%2F%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E7%9A%84%E5%8F%8D%E5%90%91%E8%AF%AF%E5%B7%AE%E4%BC%A0%E6%92%AD%2F</url>
    <content type="text"><![CDATA[ä¸€ã€ä¸€èˆ¬çš„å…¨è¿æ¥ç¥ç»ç½‘ç»œç»“æ„1.1 â€œå±‚â€çš„æ¦‚å¿µæ¯ä¸ªâ€œå±‚â€åœ¨ç¥ç»ç½‘ç»œä¸­è¢«å®ç°ä¸ºä¸€ä¸ªç±»ï¼Œä½œä¸ºç¥ç»ç½‘ç»œä¸­çš„åŠŸèƒ½å•ä½ï¼Œç±»ä¸­å®šä¹‰äº†æ­¤å±‚æ¥å—çš„è¾“å…¥ï¼Œè¿ç®—å’Œè¾“å‡ºã€‚æ¯”å¦‚ï¼Œè´Ÿè´£æ¿€æ´»å‡½æ•°çš„å±‚å°±æ˜¯Sigmoidå±‚ï¼ŒReLUå±‚ç­‰ç­‰ï¼Œè´Ÿè´£çŸ©é˜µç›¸ä¹˜çš„å°±æ˜¯ä¸Šæ¬¡æåˆ°çš„Affineå±‚ã€‚ä»¥Affineå±‚å’ŒReLUå±‚ä¸ºä¾‹ 123456789101112131415161718AffineX = np.random.rand(2) # è¾“å…¥W = np.random.rand(2ï¼Œ3) # æƒé‡å‚æ•°B = np.random.rand(3) # åç½®Y = np.dot(X, W) + B # å¾—åˆ°ç›¸ä¹˜ç»“æœclass Relu: def __init__(self): self.mask = None # maskè¿™ä¸ªå˜é‡åœ¨åå‘ä¼ æ’­æ—¶å¾ˆé‡è¦ï¼Œç¨åä¼šæåˆ° def forward(self, x): # æ­£å‘ä¼ æ’­ self.mask = (x &lt;= 0) out = x.copy() out[self.mask] = 0 return out def backward(self, dout): # åå‘ä¼ æ’­ dout[self.mask] = 0 dx = dout return dx è¿™é‡ŒAffineä¸­çš„ Xã€Wã€B åˆ†åˆ«æ˜¯å½¢çŠ¶ä¸º (2,)ã€(2,3)ã€(3,) çš„å¤šç»´æ•°ç»„ã€‚è¿™æ ·ä¸€æ¥ï¼Œç¥ç»å…ƒçš„åŠ æƒå’Œå¯ä»¥ç”¨ Y = np.dot(X, W) + B è®¡ç®—å‡ºæ¥ã€‚ç„¶åï¼ŒY ç»è¿‡æ¿€æ´»å‡½æ•°è½¬æ¢åï¼Œä¼ é€’ç»™ä¸‹ä¸€å±‚ã€‚è¿™å°±æ˜¯ç¥ç»ç½‘ç»œæ­£å‘ä¼ æ’­çš„æµç¨‹ã€‚è°ƒç”¨æ¿€æ´»å±‚ä¸­çš„ forward æ­£å‘ä¼ æ’­ã€‚ äºŒã€æ­£å‘ä¼ æ’­æ—¶çš„æ¢¯åº¦ä¸‹é™æ³•åœ¨æ­£å‘ä¼ æ’­ä¸­ï¼Œé‡‡ç”¨æ•°å€¼å¾®åˆ†æ³•æ±‚æ¢¯åº¦åœ¨æ¯ä¸€å±‚ï¼Œé‡‡ç”¨æ•°å€¼å¾®åˆ†æ³•åˆ†åˆ«æ±‚æŸå¤±å‡½æ•°å¯¹äºè¯¥å±‚çš„å„ä¸ªæƒé‡å‚æ•°çš„åå¯¼æ•°ï¼Œç»„åˆæˆæ¢¯åº¦ï¼Œç„¶åä»¤å„å‚æ•°å‘æ¢¯åº¦ä¸‹é™çš„æ–¹å‘æ›´æ–°ã€‚ä»£ç å…¶å®å¾ˆå¥½æ‡‚ï¼Œç®€ç›´å°±åƒå¤§ç™½è¯ï¼Œè¿™é‡Œä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ã€‚ 123456789101112131415161718192021222324# æ±‚æ¢¯åº¦def numerical_gradient(f, x): # xä¸ºä¼ å…¥çš„å„å‚æ•°çš„æ•°ç»„/å¤šç»´æ•°ç»„ h = 1e-4 # 0.0001 grad = np.zeros_like(x) # ç”Ÿæˆå’Œxå½¢çŠ¶ç›¸åŒçš„æ•°ç»„ for idx in range(x.size): tmp_val = x[idx] # f(x+h)çš„è®¡ç®— x[idx] = tmp_val + h fxh1 = f(x) # f(x-h)çš„è®¡ç®— x[idx] = tmp_val - h fxh2 = f(x) # ç»„åˆä¸ºæ¢¯åº¦ grad[idx] = (fxh1 - fxh2) / (2*h) x[idx] = tmp_val # è¿˜åŸå€¼ return grad# æ¢¯åº¦ä¸‹é™æ³•def gradient_descent(f, init_x, lr=0.01, step_num=100): x = init_x for i in range(step_num): grad = numerical_gradient(f, x) x -= lr * grad return x æ¢¯åº¦ä¸‹é™æ³•çš„å‡½æ•°çš„å‚æ•°ä¸­ï¼Œf ä¸ºæˆ‘ä»¬é€‰ç”¨çš„æŸå¤±å‡½æ•°ï¼Œxä¸ºå„å±‚ä¼ å…¥çš„å‚æ•°æ•°ç»„ï¼Œlrä¸ºå­¦ä¹ ç‡ï¼Œä¹Ÿå°±æ˜¯å‚æ•°æ¯æ¬¡æ›´æ–°çš„ç¨‹åº¦ï¼Œstep_numä¸ºæ›´æ–°çš„è½®æ•°ã€‚ è¿™å°±æ˜¯é€šè¿‡æ•°å€¼å¾®åˆ†æ³•è®¡ç®—æŸå¤±å‡½æ•°å…³äºæƒé‡å‚æ•°çš„æ¢¯åº¦ã€‚æ•°å€¼å¾®åˆ†è™½ç„¶ç®€å•ï¼Œä¹Ÿå®¹æ˜“å®ç°ï¼Œä½†ç¼ºç‚¹æ˜¯è®¡ç®—ä¸Šæ¯”è¾ƒè´¹æ—¶é—´ã€‚æ‰€ä»¥æˆ‘ä»¬å°†å­¦ä¹ ä¸€ä¸ªèƒ½å¤Ÿé«˜æ•ˆè®¡ç®—æƒé‡å‚æ•°çš„æ¢¯åº¦çš„æ–¹æ³•â€”â€”è¯¯å·®åå‘ä¼ æ’­æ³•ã€‚ ä¸‰ã€è¯¯å·®åå‘ä¼ æ’­æ³•3.1 è®¡ç®—å›¾3.1.1 åˆ©ç”¨è®¡ç®—å›¾æ±‚è§£è®¡ç®—å›¾è§£é¢˜çš„æƒ…å†µä¸‹ï¼Œéœ€è¦æŒ‰å¦‚ä¸‹æµç¨‹è¿›è¡Œ æ„å»ºè®¡ç®—å›¾ã€‚ åœ¨è®¡ç®—å›¾ä¸Šï¼Œä»å·¦å‘å³è¿›è¡Œè®¡ç®—ã€‚ï¼ˆæ­£å‘ä¼ æ’­ï¼‰ ç°åœ¨æˆ‘ä»¬å°è¯•ç”¨è®¡ç®—å›¾æ±‚è§£ç®€å•çš„é—®é¢˜é—®é¢˜1ï¼š å¤ªéƒåœ¨è¶…å¸‚ä¹°äº†2ä¸ª100å…ƒä¸€ä¸ªçš„è‹¹æœï¼Œæ¶ˆè´¹ç¨æ˜¯10%ï¼Œè¯·è®¡ç®—æ”¯ä»˜é‡‘é¢ã€‚ é—®é¢˜2ï¼šå¤ªéƒåœ¨è¶…å¸‚ä¹°äº†2ä¸ªè‹¹æœã€3ä¸ªæ©˜å­ã€‚å…¶ä¸­ï¼Œè‹¹æœæ¯ä¸ª100å…ƒï¼Œ æ©˜å­æ¯ä¸ª150å…ƒã€‚æ¶ˆè´¹ç¨æ˜¯10%ï¼Œè¯·è®¡ç®—æ”¯ä»˜é‡‘é¢ã€‚ 3.1.2 å±€éƒ¨è®¡ç®—è®¡ç®—å›¾çš„ç‰¹å¾æ˜¯å¯ä»¥é€šè¿‡ä¼ é€’â€œå±€éƒ¨è®¡ç®—â€è·å¾—æœ€ç»ˆç»“æœã€‚â€œå±€éƒ¨â€è¿™ä¸ª è¯çš„æ„æ€æ˜¯â€œä¸è‡ªå·±ç›¸å…³çš„æŸä¸ªå°èŒƒå›´â€ã€‚å±€éƒ¨è®¡ç®—æ˜¯æŒ‡ï¼Œæ— è®ºå…¨å±€å‘ç”Ÿäº†ä»€ä¹ˆï¼Œ éƒ½èƒ½åªæ ¹æ®ä¸è‡ªå·±ç›¸å…³çš„ä¿¡æ¯è¾“å‡ºæ¥ä¸‹æ¥çš„ç»“æœã€‚æˆ‘ä»¬ç”¨ä¸€ä¸ªå…·ä½“çš„ä¾‹å­æ¥è¯´æ˜å±€éƒ¨è®¡ç®—ã€‚æ¯”å¦‚ï¼Œåœ¨è¶…å¸‚ä¹°äº†2ä¸ªè‹¹æœå’Œå…¶ä»–å¾ˆå¤šä¸œè¥¿ã€‚æ­¤æ—¶ï¼Œå¯ä»¥ç”»å‡ºå¦‚å›¾3-3æ‰€ç¤ºçš„è®¡ç®—å›¾ã€‚ å¦‚å›¾3-3æ‰€ç¤ºï¼Œå‡è®¾ï¼ˆç»è¿‡å¤æ‚çš„è®¡ç®—ï¼‰è´­ä¹°çš„å…¶ä»–å¾ˆå¤šä¸œè¥¿æ€»å…±èŠ±è´¹4000å…ƒã€‚è¿™é‡Œçš„é‡ç‚¹æ˜¯ï¼Œå„ä¸ªèŠ‚ç‚¹å¤„çš„è®¡ç®—éƒ½æ˜¯å±€éƒ¨è®¡ç®—ã€‚è¿™æ„å‘³ç€ï¼Œä¾‹å¦‚è‹¹æœå’Œå…¶ä»–å¾ˆå¤šä¸œè¥¿çš„æ±‚å’Œè¿ç®—ï¼ˆ4000 + 200 â†’ 4200ï¼‰å¹¶ä¸å…³å¿ƒ4000è¿™ä¸ªæ•°å­—æ˜¯å¦‚ä½•è®¡ç®—è€Œæ¥çš„ï¼Œåªè¦æŠŠä¸¤ä¸ªæ•°å­—ç›¸åŠ å°±å¯ä»¥äº†ã€‚æ¢è¨€ä¹‹ï¼Œå„ä¸ªèŠ‚ç‚¹å¤„åªéœ€è¿›è¡Œä¸è‡ªå·±æœ‰å…³çš„è®¡ç®—ï¼ˆåœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯å¯¹è¾“å…¥çš„ä¸¤ä¸ªæ•°å­—è¿›è¡ŒåŠ æ³•è¿ç®—ï¼‰ï¼Œä¸ç”¨è€ƒè™‘å…¨å±€ã€‚ç»¼ä¸Šï¼Œè®¡ç®—å›¾å¯ä»¥é›†ä¸­ç²¾åŠ›äºå±€éƒ¨è®¡ç®—ã€‚æ— è®ºå…¨å±€çš„è®¡ç®—æœ‰å¤šä¹ˆå¤æ‚ï¼Œ å„ä¸ªæ­¥éª¤æ‰€è¦åšçš„å°±æ˜¯å¯¹è±¡èŠ‚ç‚¹çš„å±€éƒ¨è®¡ç®—ã€‚è™½ç„¶å±€éƒ¨è®¡ç®—éå¸¸ç®€å•ï¼Œä½†æ˜¯é€šè¿‡ä¼ é€’å®ƒçš„è®¡ç®—ç»“æœï¼Œå¯ä»¥è·å¾—å…¨å±€çš„å¤æ‚è®¡ç®—çš„ç»“æœã€‚ 3.1.3 ä¸ºä½•ä½¿ç”¨è®¡ç®—å›¾å®é™…ä¸Šï¼Œä½¿ç”¨è®¡ç®—å›¾æœ€å¤§çš„åŸå› æ˜¯ï¼Œå¯ä»¥é€šè¿‡åå‘ä¼ æ’­é«˜æ•ˆè®¡ç®—å¯¼æ•°ã€‚ åœ¨ä»‹ç»è®¡ç®—å›¾çš„åå‘ä¼ æ’­æ—¶ï¼Œæˆ‘ä»¬å†æ¥æ€è€ƒä¸€ä¸‹é—®é¢˜1ã€‚é—®é¢˜1ä¸­ï¼Œå‡è®¾æˆ‘ä»¬æƒ³çŸ¥é“è‹¹æœä»·æ ¼çš„ä¸Šæ¶¨ä¼šåœ¨å¤šå¤§ç¨‹åº¦ä¸Šå½±å“æœ€ç»ˆçš„æ”¯ä»˜é‡‘é¢ï¼Œå³æ±‚â€œæ”¯ä»˜é‡‘é¢å…³äºè‹¹æœçš„ä»·æ ¼çš„å¯¼æ•°â€ã€‚è®¾è‹¹æœçš„ä»·æ ¼ä¸º xï¼Œæ”¯ä»˜é‡‘é¢ä¸º Lï¼Œåˆ™ç›¸å½“äºæ±‚ $ \frac{dL}{dX} $ã€‚å…ˆæ¥çœ‹ä¸€ä¸‹ç»“æœï¼Œå¦‚å›¾3-4æ‰€ç¤ºï¼Œå¯ä»¥é€šè¿‡è®¡ç®—å›¾çš„åå‘ä¼ æ’­æ±‚å¯¼æ•°ï¼ˆå…³äºå¦‚ä½•è¿›è¡Œåå‘ä¼ æ’­ï¼Œæ¥ä¸‹æ¥é©¬ä¸Šä¼šä»‹ç»ï¼‰ã€‚å¦‚å›¾3-4æ‰€ç¤ºï¼Œåå‘ä¼ æ’­ä½¿ç”¨ä¸æ­£æ–¹å‘ç›¸åçš„ç®­å¤´ï¼ˆç²—çº¿ï¼‰è¡¨ç¤ºã€‚åå‘ä¼ æ’­ä¼ é€’â€œå±€éƒ¨å¯¼æ•°â€ï¼Œå°†å¯¼æ•°çš„å€¼å†™åœ¨ç®­å¤´çš„ä¸‹æ–¹ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œåå‘ä¼ æ’­ä»å³å‘å·¦ä¼ é€’å¯¼æ•°çš„å€¼ï¼ˆ1â†’1.1â†’2.2ï¼‰ã€‚ä»è¿™ä¸ªç»“æœä¸­å¯çŸ¥ï¼Œâ€œæ”¯ä»˜é‡‘é¢å…³äºè‹¹æœçš„ä»·æ ¼çš„å¯¼æ•°â€çš„å€¼æ˜¯2.2 â€œæ”¯ä»˜é‡‘é¢å…³äºæ¶ˆè´¹ç¨çš„å¯¼æ•°â€â€œæ”¯ä»˜é‡‘é¢å…³äºè‹¹æœçš„ä¸ªæ•°çš„å¯¼æ•°â€ç­‰ä¹Ÿéƒ½å¯ä»¥ç”¨åŒæ ·çš„æ–¹å¼ç®—å‡ºæ¥ã€‚å¹¶ä¸”, è®¡ç®—ä¸­é€”æ±‚å¾—çš„å¯¼æ•°çš„ç»“æœï¼ˆä¸­é—´ä¼ é€’çš„å¯¼æ•°ï¼‰å¯ä»¥è¢«å…±äº«ï¼Œä»è€Œå¯ä»¥é«˜æ•ˆåœ°è®¡ç®—å¤šä¸ªå¯¼æ•°ã€‚ç»¼ä¸Šï¼Œè®¡ç®—å›¾çš„ä¼˜ç‚¹æ˜¯ï¼Œå¯ä»¥é€šè¿‡æ­£å‘ä¼ æ’­å’Œåå‘ä¼  æ’­é«˜æ•ˆåœ°è®¡ç®—å„ä¸ªå˜é‡çš„å¯¼æ•°å€¼ã€‚ 3.2 é“¾å¼æ³•åˆ™3.2.1 è®¡ç®—å›¾çš„åå‘ä¼ æ’­è¯ä¸å¤šè¯´ï¼Œè®©æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªä½¿ç”¨è®¡ç®—å›¾çš„åå‘ä¼ æ’­çš„ä¾‹å­ã€‚å‡è®¾å­˜åœ¨ y = f(x)çš„è®¡ç®—ï¼Œè¿™ä¸ªè®¡ç®—çš„åå‘ä¼ æ’­å¦‚å›¾3-4æ‰€ç¤ºã€‚ å¦‚å›¾æ‰€ç¤ºï¼Œåå‘ä¼ æ’­çš„è®¡ç®—é¡ºåºæ˜¯ï¼Œå°†ä¿¡å·Eä¹˜ä»¥èŠ‚ç‚¹çš„å±€éƒ¨å¯¼æ•° ï¼ˆ $\frac{dy}{dx}$ï¼‰ï¼Œç„¶åå°†ç»“æœä¼ é€’ç»™ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚è¿™é‡Œæ‰€è¯´çš„å±€éƒ¨å¯¼æ•°æ˜¯æŒ‡æ­£å‘ä¼ æ’­ä¸­$y = f(x) $çš„å¯¼æ•°ï¼Œä¹Ÿå°±æ˜¯yå…³äºxçš„å¯¼æ•°ï¼ˆ $\frac{dy}{dx}$ï¼‰ã€‚æŠŠè¿™ä¸ªå±€éƒ¨å¯¼æ•°ä¹˜ä»¥ä¸Šæ¸¸ä¼ è¿‡æ¥çš„å€¼ï¼ˆæœ¬ä¾‹ä¸­ä¸ºEï¼‰ï¼Œ ç„¶åä¼ é€’ç»™å‰é¢çš„èŠ‚ç‚¹ã€‚ 3.2.2 é“¾å¼æ³•åˆ™é“¾å¼æ³•åˆ™æ˜¯å…³äºå¤åˆå‡½æ•°çš„å¯¼æ•°çš„æ€§è´¨ï¼Œå®šä¹‰å¦‚ä¸‹ã€‚ å¦‚æœæŸä¸ªå‡½æ•°ç”±å¤åˆå‡½æ•°è¡¨ç¤ºï¼Œåˆ™è¯¥å¤åˆå‡½æ•°çš„å¯¼æ•°å¯ä»¥ç”¨æ„æˆå¤åˆå‡½æ•°çš„å„ä¸ªå‡½æ•°çš„å¯¼æ•°çš„ä¹˜ç§¯è¡¨ç¤ºã€‚ å½¢å¦‚ $\frac{dZ}{dX} = \frac{dZ}{dt} \frac{dt}{dZ} $ï¼Œ å³ä¸ºæ±‚å¯¼çš„é“¾å¼æ³•åˆ™ã€‚é«˜æ•°å†…å®¹ï¼Œä¸å†èµ˜è¿°ã€‚ 3.2.3 é“¾å¼æ³•åˆ™ä¸è®¡ç®—å›¾ç°åœ¨æˆ‘ä»¬å°è¯•å°†ä¸Šå¼çš„é“¾å¼æ³•åˆ™çš„è®¡ç®—ç”¨è®¡ç®—å›¾è¡¨ç¤ºå‡ºæ¥ã€‚å¦‚æœç”¨ â€œ**2â€èŠ‚ç‚¹è¡¨ç¤ºå¹³æ–¹è¿ç®—çš„è¯ï¼Œåˆ™è®¡ç®—å›¾å¦‚å›¾3-5æ‰€ç¤ºã€‚å› ä¸º$\frac{dz}{dt} = 2t $; $\frac{dt}{dx} = 1 $ ; æ‰€ä»¥$\frac{dz}{dx} = 2(x+y) $ 3.3 åå‘ä¼ æ’­3.3.1 åŠ æ³•çš„åå‘ä¼ æ’­åŠ æ³•åå‘ä¼ æ’­å°†ä»ä¸Šæ¸¸ä¼ è¿‡æ¥çš„å¯¼æ•°ï¼ˆæœ¬ä¾‹ä¸­æ˜¯ ï¼‰ä¹˜ä»¥ 1ï¼Œç„¶ åä¼ å‘ä¸‹æ¸¸ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå› ä¸ºåŠ æ³•èŠ‚ç‚¹çš„åå‘ä¼ æ’­åªä¹˜ä»¥1ï¼Œæ‰€ä»¥è¾“å…¥çš„å€¼ ä¼šåŸå°ä¸åŠ¨åœ°æµå‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚ 3.3.2 ä¹˜æ³•çš„åå‘ä¼ æ’­ä¹˜æ³•çš„åå‘ä¼ æ’­ä¼šå°†ä¸Šæ¸¸çš„å€¼ä¹˜ä»¥æ­£å‘ä¼ æ’­æ—¶çš„è¾“å…¥ä¿¡å·çš„â€œç¿»è½¬å€¼â€ åä¼ é€’ç»™ä¸‹æ¸¸ã€‚ç¿»è½¬å€¼è¡¨ç¤ºä¸€ç§ç¿»è½¬å…³ç³»ï¼Œå¦‚å›¾5-12æ‰€ç¤ºï¼Œæ­£å‘ä¼ æ’­æ—¶ä¿¡å· æ˜¯xçš„è¯ï¼Œåå‘ä¼ æ’­æ—¶åˆ™æ˜¯yï¼›æ­£å‘ä¼ æ’­æ—¶ä¿¡å·æ˜¯yçš„è¯ï¼Œåå‘ä¼ æ’­æ—¶åˆ™æ˜¯xã€‚ ç»ƒä¹ ç»“åˆåŠ æ³•å’Œä¹˜æ³•ï¼Œä»¥è‹¹æœä¸ºä¾‹ï¼Œå°è¯•å¡«å…¥è¿™äº›ç©ºæ ¼ 3.4 æ¿€æ´»å‡½æ•°å±‚çš„åå‘ä¼ æ’­å®ç°3.4.1 ReLU å±‚æ¿€æ´»å‡½æ•°ReLUçš„å¯¼æ•°ä¸ºå¦‚æœæ­£å‘ä¼ æ’­æ—¶çš„è¾“å…¥xå¤§äº0ï¼Œåˆ™åå‘ä¼ æ’­ä¼šå°†ä¸Šæ¸¸çš„ å€¼åŸå°ä¸åŠ¨åœ°ä¼ ç»™ä¸‹æ¸¸ã€‚åè¿‡æ¥ï¼Œå¦‚æœæ­£å‘ä¼ æ’­æ—¶çš„xå°äºç­‰äº0ï¼Œåˆ™åå‘ä¼ æ’­ä¸­ä¼ ç»™ä¸‹æ¸¸çš„ä¿¡å·å°†åœåœ¨æ­¤å¤„æ‰€ä»¥åœ¨å¼€å§‹æ—¶æåˆ°çš„ReLUå±‚çš„maskå˜é‡ï¼Œæ˜¯ç”¨æ¥å­˜å‚¨æ­£å‘ä¼ æ’­è¾“å…¥æ˜¯å¦ä¸º0çš„å˜é‡ï¼Œå®ƒæ˜¯ç”±True/Falseæ„æˆçš„NumPyæ•°ç»„ï¼Œå®ƒä¼šæŠŠæ­£å‘ä¼ æ’­æ—¶çš„è¾“å…¥xçš„å…ƒç´ ä¸­å°äºç­‰äº0çš„åœ°æ–¹ä¿å­˜ä¸ºTrueï¼Œå…¶ä»–åœ°æ–¹ï¼ˆå¤§äº0çš„å…ƒç´ ï¼‰ä¿å­˜ä¸ºFalseã€‚åœ¨åå‘ä¼ æ’­ä¸­å°¤å…¶é‡è¦ã€‚è®¡ç®—å›¾è¡¨ç¤ºå³ä¸º 3.4.2 Sigmoidå±‚æ­¥éª¤1â€œ/â€èŠ‚ç‚¹è¡¨ç¤º ï¼Œå®ƒçš„å¯¼æ•°å¯ä»¥è§£ææ€§åœ°è¡¨ç¤ºä¸ºä¸‹å¼ã€‚$ \frac{dy}{dx} = - \frac{1}{x^2} = - y^2 $åå‘ä¼ æ’­æ—¶ï¼Œä¼šå°†ä¸Šæ¸¸çš„å€¼ä¹˜ä»¥$âˆ’y^2$ï¼ˆæ­£å‘ä¼ æ’­çš„è¾“å‡ºçš„å¹³æ–¹ä¹˜ä»¥âˆ’1åçš„å€¼ï¼‰åï¼Œå†ä¼ ç»™ä¸‹æ¸¸ã€‚ æ­¥éª¤2 â€œ+â€èŠ‚ç‚¹å°†ä¸Šæ¸¸çš„å€¼åŸå°ä¸åŠ¨åœ°ä¼ ç»™ä¸‹æ¸¸ã€‚ æ­¥éª¤3â€œexpâ€èŠ‚ç‚¹è¡¨ç¤ºy = exp(x)ï¼Œå®ƒçš„å¯¼æ•°ç”±ä¸‹å¼è¡¨ç¤ºã€‚$ \frac{dy}{dx} = exp(x) $è®¡ç®—å›¾ä¸­ï¼Œä¸Šæ¸¸çš„å€¼ä¹˜ä»¥æ­£å‘ä¼ æ’­æ—¶çš„è¾“å‡ºï¼ˆè¿™ä¸ªä¾‹å­ä¸­æ˜¯exp(âˆ’x)ï¼‰åï¼Œ å†ä¼ ç»™ä¸‹æ¸¸ã€‚ æ­¥éª¤4â€œÃ—â€èŠ‚ç‚¹å°†æ­£å‘ä¼ æ’­æ—¶çš„å€¼ç¿»è½¬ååšä¹˜æ³•è¿ç®—ã€‚å› æ­¤ï¼Œè¿™é‡Œè¦ä¹˜ä»¥âˆ’1ã€‚ æœ€ç»ˆç»“æœä¸º è¿™é‡Œè¦æ³¨æ„ï¼Œ è¿™ä¸ªå€¼åªæ ¹æ®æ­£å‘ä¼ æ’­æ—¶çš„è¾“å…¥xå’Œè¾“å‡ºyå°±å¯ä»¥ç®—å‡ºæ¥,æ‰€ä»¥sigmoidçš„è®¡ç®—å›¾å¯ä»¥ç®€åŒ–ä¸ºsigmoidèŠ‚ç‚¹ï¼Œç®€æ´ç‰ˆçš„è®¡ç®—å›¾å¯ä»¥çœç•¥åå‘ä¼ æ’­ä¸­çš„è®¡ç®—è¿‡ç¨‹ï¼Œå› æ­¤è®¡ç®—æ•ˆç‡æ›´é«˜ã€‚æ­¤å¤–ï¼Œ é€šè¿‡å¯¹èŠ‚ç‚¹è¿›è¡Œé›†çº¦åŒ–ï¼Œå¯ä»¥ä¸ç”¨åœ¨æ„Sigmoidå±‚ä¸­çç¢çš„ç»†èŠ‚ï¼Œè€Œåªéœ€è¦ä¸“æ³¨å®ƒçš„è¾“å…¥å’Œè¾“å‡ºï¼Œè¿™ä¸€ç‚¹ä¹Ÿå¾ˆé‡è¦ã€‚ 3.5 Affine/Softmaxå±‚çš„å®ç°3.5.1 Affineå±‚ç¥ç»ç½‘ç»œçš„æ­£å‘ä¼ æ’­ä¸­ï¼Œä¸ºäº†è®¡ç®—åŠ æƒä¿¡å·çš„æ€»å’Œï¼Œä½¿ç”¨äº†çŸ©é˜µçš„ä¹˜ç§¯è¿ç®— 12345AffineX = np.random.rand(2) # è¾“å…¥W = np.random.rand(2ï¼Œ3) # æƒé‡å‚æ•°B = np.random.rand(3) # åç½®Y = np.dot(X, W) + B # å¾—åˆ°ç›¸ä¹˜ç»“æœ ç¥ç»ç½‘ç»œçš„æ­£å‘ä¼ æ’­ä¸­è¿›è¡Œçš„çŸ©é˜µçš„ä¹˜ç§¯è¿ç®—åœ¨å‡ ä½•å­¦é¢†åŸŸè¢«ç§°ä¸ºâ€œä»¿ å°„å˜æ¢â€ Aã€‚å› æ­¤ï¼Œè¿™é‡Œå°†è¿›è¡Œä»¿å°„å˜æ¢çš„å¤„ç†å®ç°ä¸ºâ€œAffineå±‚â€ã€‚ ç°åœ¨å°†å®ƒç”¨è®¡ç®—å›¾è¡¨ç¤ºå‡ºæ¥ï¼Œè¦æ³¨æ„Xã€Wã€Bæ˜¯çŸ©é˜µï¼ˆå¤šç»´æ•°ç»„ï¼‰ã€‚ ä¹‹å‰æˆ‘ä»¬è§åˆ°çš„è®¡ç®—å›¾ä¸­å„ä¸ªèŠ‚ç‚¹é—´æµåŠ¨çš„æ˜¯æ ‡é‡ï¼Œè€Œè¿™ä¸ªä¾‹å­ä¸­å„ä¸ªèŠ‚ç‚¹é—´ä¼ æ’­çš„æ˜¯çŸ©é˜µã€‚ç°åœ¨æˆ‘ä»¬æ¥è€ƒè™‘å›¾ 3-14 çš„è®¡ç®—å›¾çš„åå‘ä¼ æ’­ã€‚ä»¥çŸ©é˜µä¸ºå¯¹è±¡çš„åå‘ä¼ æ’­ï¼Œé€šè¿‡æ•°å­¦æ¨å¯¼å¯å¾—åˆ°ä¸‹å¼$$ \frac{dL}{dX} = \frac{dL}{dY} * W^T $$$$ \frac{dL}{dW} = X^T * \frac{dL}{dY} $$è¡¨ç¤ºä¸ºè®¡ç®—å›¾å³ä¸ºï¼šå…¶ä¸­å€¼å¾—æ³¨æ„çš„æ˜¯,Xä¸$\frac{dL}{dX}$å½¢çŠ¶ç›¸åŒï¼ŒWä¸$\frac{dL}{dW}$å½¢çŠ¶ç›¸åŒ,ä»ä¸‹å¼ä¹Ÿå®¹æ˜“çœ‹å‡º 3.5.2 æ‰¹ç‰ˆæœ¬çš„Affineå±‚å‰é¢ä»‹ç»çš„Affi neå±‚çš„è¾“å…¥Xæ˜¯ä»¥å•ä¸ªæ•°æ®ä¸ºå¯¹è±¡çš„ã€‚ç°åœ¨æˆ‘ä»¬è€ƒè™‘N ä¸ªæ•°æ®ä¸€èµ·è¿›è¡Œæ­£å‘ä¼ æ’­çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯æ‰¹ç‰ˆæœ¬çš„Affineå±‚ã€‚å…ˆæ¥çœ‹è®¡ç®—å›¾ä¸åˆšåˆšä¸åŒçš„æ˜¯ï¼Œç°åœ¨è¾“å…¥Xçš„å½¢çŠ¶æ˜¯(N,2)ã€‚ä¹‹åå°±å’Œå‰é¢ä¸€æ ·ï¼Œåœ¨è®¡ç®—å›¾ä¸Šè¿›è¡Œå•çº¯çš„çŸ©é˜µè®¡ç®—ã€‚åŠ ä¸Šåç½®æ—¶ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„ã€‚æ­£å‘ä¼ æ’­æ—¶ï¼Œåç½®è¢«åŠ åˆ°XÂ·Wçš„å„ä¸ªæ•°æ®ä¸Šã€‚æ¯”å¦‚ï¼ŒN = 2ï¼ˆæ•°æ®ä¸º2ä¸ªï¼‰æ—¶ï¼Œåç½®ä¼šè¢«åˆ†åˆ«åŠ åˆ°è¿™2ä¸ªæ•°æ®ï¼ˆå„è‡ª çš„è®¡ç®—ç»“æœï¼‰ä¸Šã€‚å› æ­¤ï¼Œ åå‘ä¼ æ’­æ—¶ï¼Œå„ä¸ªæ•°æ®çš„åå‘ä¼ æ’­çš„å€¼éœ€è¦æ±‡æ€»ä¸ºåç½®çš„å…ƒç´ ã€‚ 12345678&gt;&gt;&gt; dY = np.array([[1, 2, 3,], [4, 5, 6]]) &gt;&gt;&gt; dY array([[1, 2, 3], [4, 5, 6]]) &gt;&gt;&gt; &gt;&gt;&gt; dB = np.sum(dY, axis=0) &gt;&gt;&gt; dB array([5, 7, 9]) è¿™ä¸ªä¾‹å­ä¸­ï¼Œå‡å®šæ•°æ®æœ‰2ä¸ªï¼ˆN = 2ï¼‰ã€‚åç½®çš„åå‘ä¼ æ’­ä¼šå¯¹è¿™2ä¸ªæ•°æ®çš„å¯¼æ•°æŒ‰å…ƒç´ è¿›è¡Œæ±‚å’Œã€‚å› æ­¤ï¼Œè¿™é‡Œä½¿ç”¨äº†np.sum()å¯¹ç¬¬0è½´ï¼ˆä»¥æ•°æ®ä¸ºå•ä½çš„è½´ï¼Œaxis=0ï¼‰æ–¹å‘ä¸Šçš„å…ƒç´ è¿›è¡Œæ±‚å’Œã€‚ 3.5.3 Softmax-with-Loss å±‚ä¸Šæ¬¡æˆ‘ä»¬æåˆ°è¿‡ï¼Œsoftmaxå‡½æ•°ä¼šå°†è¾“å…¥å€¼æ­£è§„åŒ–ä¹‹åå†è¾“å‡ºã€‚æ¯”å¦‚æ‰‹å†™æ•°å­—è¯†åˆ«æ—¶ï¼ŒSoftmaxå±‚çš„è¾“å‡ºå¦‚ä¸‹æ‰€ç¤ºã€‚ ç¥ç»ç½‘ç»œä¸­è¿›è¡Œçš„å¤„ç†æœ‰æ¨ç†ï¼ˆinferenceï¼‰å’Œå­¦ä¹ ä¸¤ä¸ªé˜¶æ®µã€‚ç¥ç»ç½‘ç»œçš„æ¨ç†é€šå¸¸ä¸ä½¿ç”¨Softmaxå±‚ã€‚æ¯”å¦‚ï¼Œç”¨ä¸Šå›¾çš„ç½‘ç»œè¿›è¡Œæ¨ç†æ—¶ï¼Œ ä¼šå°†æœ€åä¸€ä¸ªAffineå±‚çš„è¾“å‡ºä½œä¸ºè¯†åˆ«ç»“æœã€‚ç¥ç»ç½‘ç»œä¸­æœªè¢«æ­£è§„åŒ–çš„è¾“å‡ºç»“æœï¼ˆSoftmaxå±‚å‰é¢çš„Affineå±‚çš„è¾“å‡ºï¼‰æœ‰æ—¶è¢«ç§°ä¸ºâ€œå¾—åˆ†â€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ç¥ç»ç½‘ç»œçš„æ¨ç†åªéœ€è¦ç»™å‡ºä¸€ä¸ªç­”æ¡ˆçš„æƒ…å†µä¸‹ï¼Œå› ä¸ºæ­¤æ—¶åªå¯¹å¾—åˆ†æœ€å¤§å€¼æ„Ÿå…´è¶£ï¼Œæ‰€ä»¥ä¸éœ€è¦Softmaxå±‚ã€‚ ä¸è¿‡ï¼Œç¥ç»ç½‘ç»œçš„å­¦ä¹ é˜¶æ®µåˆ™éœ€è¦Softmaxå±‚ã€‚ æ¥çœ‹softmaxçš„è®¡ç®—å›¾ï¼Œå¯¼å‡ºè¿‡ç¨‹æ¯”è¾ƒå¤æ‚ï¼Œè¿™é‡Œåªç»™å‡ºæœ€ç»ˆç»“æœ ä¸æ„Ÿå…´è¶£çš„è¯å¯ä»¥çœ‹ç®€åŒ–ç‰ˆæœ¬ Softmaxå±‚çš„åå‘ä¼ æ’­å¾—åˆ°äº† $ï¼ˆy_1 âˆ’t_1,y_2 âˆ’t_2,y_3 âˆ’t_3ï¼‰$è¿™æ ·â€œæ¼‚äº®â€çš„ç»“æœã€‚ç”±äº$ï¼ˆy_1,y_2,y_3ï¼‰$æ˜¯ Softmaxå±‚çš„è¾“å‡ºï¼Œ$ï¼ˆ t_1,t_2,t_3ï¼‰$æ˜¯ç›‘ç£æ•°æ®ï¼Œæ‰€ä»¥$ï¼ˆy_1 âˆ’t_1,y_2 âˆ’t_2,y_3 âˆ’t_3ï¼‰$æ˜¯ Softmaxå±‚çš„è¾“å‡ºå’Œæ•™å¸ˆæ ‡ç­¾çš„å·®åˆ†ã€‚ç¥ç»ç½‘ç»œçš„åå‘ä¼ æ’­ä¼šæŠŠè¿™ä¸ªå·®åˆ†è¡¨ç¤ºçš„è¯¯å·®ä¼ é€’ç»™å‰é¢çš„å±‚ï¼Œè¿™æ˜¯ç¥ç»ç½‘ç»œå­¦ä¹ ä¸­çš„é‡è¦æ€§è´¨ã€‚ç¥ç»ç½‘ç»œå­¦ä¹ çš„ç›®çš„å°±æ˜¯é€šè¿‡è°ƒæ•´æƒé‡å‚æ•°ï¼Œä½¿ç¥ç»ç½‘ç»œçš„è¾“å‡ºï¼ˆSoftmax çš„è¾“å‡ºï¼‰æ¥è¿‘æ•™å¸ˆæ ‡ç­¾ã€‚å› æ­¤ï¼Œå¿…é¡»å°†ç¥ç»ç½‘ç»œçš„è¾“å‡ºä¸æ•™å¸ˆæ ‡ç­¾çš„è¯¯å·®é«˜æ•ˆåœ°ä¼ é€’ç»™å‰é¢çš„å±‚ã€‚åˆšåˆšçš„$ï¼ˆy_1 âˆ’t_1,y_2 âˆ’t_2,y_3 âˆ’t_3ï¼‰$æ­£æ˜¯ Softmaxå±‚çš„è¾“å‡ºä¸æ•™å¸ˆæ ‡ç­¾çš„å·®ï¼Œç›´æˆªäº†å½“åœ°è¡¨ç¤ºäº†å½“å‰ç¥ç»ç½‘ç»œçš„è¾“å‡ºä¸æ•™å¸ˆæ ‡ç­¾çš„è¯¯å·®ã€‚ ä½¿ç”¨äº¤å‰ç†µè¯¯å·®ä½œä¸ºsoftmaxå‡½æ•°çš„æŸå¤±å‡½æ•°åï¼Œåå‘ä¼ æ’­å¾—åˆ° $ï¼ˆy_1 âˆ’t_1,y_2 âˆ’t_2,y_3 âˆ’t_3ï¼‰$è¿™æ · â€œæ¼‚äº®â€çš„ç»“æœã€‚å®é™…ä¸Šï¼Œè¿™æ ·â€œæ¼‚äº®â€ çš„ç»“æœå¹¶ä¸æ˜¯å¶ç„¶çš„ï¼Œè€Œæ˜¯ä¸ºäº†å¾—åˆ°è¿™æ ·çš„ç»“æœï¼Œç‰¹æ„è®¾è®¡äº†äº¤å‰ç†µè¯¯å·®å‡½æ•°ã€‚å›å½’é—®é¢˜ä¸­è¾“å‡ºå±‚ä½¿ç”¨â€œæ’ç­‰å‡½æ•°â€ï¼ŒæŸå¤±å‡½æ•°ä½¿ç”¨ â€œå¹³æ–¹å’Œè¯¯å·®â€ï¼Œä¹Ÿæ˜¯å‡ºäºåŒæ ·çš„ç†ç”±ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿ç”¨â€œå¹³ æ–¹å’Œè¯¯å·®â€ä½œä¸ºâ€œæ’ç­‰å‡½æ•°â€çš„æŸå¤±å‡½æ•°ï¼Œåå‘ä¼ æ’­æ‰èƒ½å¾—åˆ°$ï¼ˆy_1 âˆ’t_1,y_2 âˆ’t_2,y_3 âˆ’t_3ï¼‰$è¿™æ ·â€œæ¼‚äº®â€çš„ç»“æœã€‚ å››ã€ç¥ç»ç½‘ç»œå­¦ä¹ å…¨è²Œå‰æç¥ç»ç½‘ç»œä¸­æœ‰åˆé€‚çš„æƒé‡å’Œåç½®ï¼Œè°ƒæ•´æƒé‡å’Œåç½®ä»¥ä¾¿æ‹Ÿåˆè®­ç»ƒæ•°æ®çš„è¿‡ç¨‹ç§°ä¸ºå­¦ä¹ ç¥ç»ç½‘ç»œçš„å­¦ä¹ åˆ†ä¸ºä¸‹é¢4ä¸ªæ­¥éª¤ã€‚æ­¥éª¤1ï¼ˆmini-batchï¼‰ä»è®­ç»ƒæ•°æ®ä¸­éšæœºé€‰æ‹©ä¸€éƒ¨åˆ†æ•°æ®ã€‚æ­¥éª¤2ï¼ˆè®¡ç®—æ¢¯åº¦ï¼‰è®¡ç®—æŸå¤±å‡½æ•°å…³äºå„ä¸ªæƒé‡å‚æ•°çš„æ¢¯åº¦ã€‚æ­¥éª¤3ï¼ˆæ›´æ–°å‚æ•°ï¼‰å°†æƒé‡å‚æ•°æ²¿æ¢¯åº¦æ–¹å‘è¿›è¡Œå¾®å°çš„æ›´æ–°ã€‚æ­¥éª¤4ï¼ˆé‡å¤ï¼‰é‡å¤æ­¥éª¤1ã€æ­¥éª¤2ã€æ­¥éª¤3ã€‚è¿™æ¬¡ä»‹ç»çš„è¯¯å·®åå‘ä¼ æ’­æ³•ä¼šåœ¨æ­¥éª¤2ä¸­å‡ºç°ã€‚ä¸Šä¸€æ¬¡ä¸­ï¼Œæˆ‘ä»¬åˆ©ç”¨æ•°å€¼å¾®åˆ†æ±‚å¾—äº†è¿™ä¸ªæ¢¯åº¦ã€‚æ•°å€¼å¾®åˆ†è™½ç„¶å®ç°ç®€å•ï¼Œä½†æ˜¯è®¡ç®—è¦è€—è´¹è¾ƒå¤šçš„æ—¶é—´ï¼Œè€Œè¯¯å·®åå‘ä¼ æ’­æ³•å¯ä»¥å¿«é€Ÿé«˜æ•ˆåœ°è®¡ç®—æ¢¯åº¦ã€‚ è¿˜æœ‰ä¸€ç¯‡CNNå™¢ï¼Œæ¬¢è¿æŒç»­å…³æ³¨ :-D]]></content>
      <categories>
        <category>äººå·¥æ™ºèƒ½</category>
      </categories>
      <tags>
        <tag>ç¥ç»ç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hello World]]></title>
    <url>%2Fdesirelife6.github.io%2F2019%2F08%2F30%2Fhello-world%2F</url>
    <content type="text"><![CDATA[Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new "My New Post" More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment]]></content>
  </entry>
  <entry>
    <title><![CDATA[å…³äºä½œè€…]]></title>
    <url>%2Fdesirelife6.github.io%2Fabout%2Findex.html</url>
    <content type="text"><![CDATA[æˆ‘æ˜¯è°æˆ‘æ˜¯ä¸€æšçˆ±åƒé¥­çˆ±ç¡è§‰çš„å¯çˆ±ç¨‹åºçŒ¿åšå®¢å¹²å˜›ç”¨æˆ‘æƒ³å¹²å˜›å¹²å˜›é¸­å˜»å˜»å˜»å…¶å®å¯ä»¥æ¥githubç»™æˆ‘star ï¼š https://github.com/Desirelife6]]></content>
  </entry>
  <entry>
    <title><![CDATA[categories]]></title>
    <url>%2Fdesirelife6.github.io%2Fcategories%2Findex.html</url>
    <content type="text"></content>
  </entry>
  <entry>
    <title><![CDATA[tags]]></title>
    <url>%2Fdesirelife6.github.io%2Ftags%2Findex.html</url>
    <content type="text"></content>
  </entry>
</search>
